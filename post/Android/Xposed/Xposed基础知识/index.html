<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    

    <title>Xposed基础知识 | Kernweak&#39;s Blog</title>
    <meta property="og:title" content="Xposed基础知识 - Kernweak&#39;s Blog">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2021-01-02T15:39:13&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2021-01-02T15:39:13&#43;08:00'>
        
    <meta name="Keywords" content="reverse,PC,android">
    <meta name="description" content="Xposed基础知识">
        
    <meta name="author" content="Kernweak">
    <meta property="og:url" content="https://kernweak.github.io/post/Android/Xposed/Xposed%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">
    <link rel="shortcut icon" href='/favicon.ico'  type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
    
    
    
        <link rel="stylesheet" href='/css/douban.css'>
    
        <link rel="stylesheet" href='/css/other.css'>
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://kernweak.github.io/">
                        Kernweak&#39;s Blog
                    </a>
                
                <p class="description">security engineer</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="https://kernweak.github.io/">首页</a>
                    
                    <a  href="https://kernweak.github.io/tools/" title="工具">工具</a>
                    
                    <a  href="https://kernweak.github.io/archives/" title="归档">归档</a>
                    
                    <a  href="https://kernweak.github.io/about/" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    <style type="text/css">
    .post-toc {
        position: fixed;
        width: 200px;
        margin-left: -210px;
        padding: 5px 10px;
        font-family: Athelas, STHeiti, Microsoft Yahei, serif;
        font-size: 12px;
        border: 1px solid rgba(0, 0, 0, .07);
        border-radius: 5px;
        background-color: rgba(255, 255, 255, 0.98);
        background-clip: padding-box;
        -webkit-box-shadow: 1px 1px 2px rgba(0, 0, 0, .125);
        box-shadow: 1px 1px 2px rgba(0, 0, 0, .125);
        word-wrap: break-word;
        white-space: nowrap;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        z-index: 999;
        cursor: pointer;
        max-height: 70%;
        overflow-y: auto;
        overflow-x: hidden;
    }

    .post-toc .post-toc-title {
        width: 100%;
        margin: 0 auto;
        font-size: 20px;
        font-weight: 400;
        text-transform: uppercase;
        text-align: center;
    }

    .post-toc .post-toc-content {
        font-size: 15px;
    }

    .post-toc .post-toc-content>nav>ul {
        margin: 10px 0;
    }

    .post-toc .post-toc-content ul {
        padding-left: 20px;
        list-style: square;
        margin: 0.5em;
        line-height: 1.8em;
    }

    .post-toc .post-toc-content ul ul {
        padding-left: 15px;
        display: none;
    }

    @media print,
    screen and (max-width:1057px) {
        .post-toc {
            display: none;
        }
    }
</style>
<div class="post-toc" style="position: absolute; top: 188px;">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#xposed插件编写">Xposed插件编写</a>
      <ul>
        <li><a href="#2xposed插件编写">2.Xposed插件编写</a></li>
        <li><a href="#新建hook类编写hook代码">新建hook类，编写hook代码</a></li>
        <li><a href="#新建assets文件夹在assets目录下新建文件xposed_init在里面写上hook类的完整路径">新建assets文件夹，在assets目录下新建文件xposed_init,在里面写上hook类的完整路径</a></li>
      </ul>
    </li>
    <li><a href="#xposed的hook构造函数">xposed的hook构造函数</a></li>
  </ul>

  <ul>
    <li><a href="#使用java反射完成对类函数的调用">使用java反射完成对类函数的调用</a>
      <ul>
        <li><a href="#静态函数主动调用">静态函数主动调用</a></li>
        <li><a href="#非静态函数主动调用">非静态函数主动调用</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#对多dex的处理">对多dex的处理</a>
      <ul>
        <li><a href="#实例">实例</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#关于64位的支持">关于64位的支持</a></li>
  </ul>

  <ul>
    <li><a href="#xposed指纹">Xposed指纹</a></li>
  </ul>
</nav>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function () {
        var postToc = $(".post-toc");
        if (postToc.length) {
            var leftPos = $("#main").offset().left;
            if(leftPos<220){
                postToc.css({"width":leftPos-10,"margin-left":(0-leftPos)})
            }

            var t = postToc.offset().top - 20,
                a = {
                    start: {
                        position: "absolute",
                        top: t
                    },
                    process: {
                        position: "fixed",
                        top: 20
                    },
                };
            $(window).scroll(function () {
                var e = $(window).scrollTop();
                e < t ? postToc.css(a.start) : postToc.css(a.process)
            })
        }
    })
</script>
    <article class="post">
        <header>
            <h1 class="post-title">Xposed基础知识</h1>
        </header>
        <date class="post-meta meta-date">
            2021年1月2日
        </date>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="post-content">
            <h1 id="xpose原理">Xpose原理</h1>
<p>控制zygote进程，通过替换/system/bin/app_precess程序控制zygote进程，使它在系统启动过程中加载Xposed framework的一个jar文件即XposedBridge.jar,从而完成对Zygote进程及创建的Dalvik/ART虚拟机的劫持，并且能够允许开发者独立替代任何class，例如framework本身，系统UI或者随意一个app。<br>
控制程序两种方式，通过attach之后ptrace调试器，通过定制rom。</p>
<h1 id="xpose安装">Xpose安装</h1>
<p>Android5.0以后：<br>
1.对手机root，刷入recovery。<br>
下载对应zip补丁包。<br>
重启手机安装xposedinstaller并授予root权限。<br>
<a href="https://note.youdao.com/">http://dl-xda.xposed.info/framework/</a><br>
关于zip下载：<br>

        <img class="mx-auto" alt="" src="https://gitee.com/kernweak/my-blog/raw/master/img/20210106205230.png" />   
    
根据系统版本去下载。比如6以后就是ARM64。<br>
以N5，6.0为例。<br>
首先需要解锁bootloader，刷hammerhead的rom<br>
如果出现Writing &lsquo;userdata&rsquo; FAILED (remote: &lsquo;Bogus size sparse and chunk header&rsquo;)则先执行：flash-base.sh<br>
然后将image-hammerhead-mmb29s.zip解压到某个文件夹，紧接着创建一个在文件夹中创建一个flash-image.bat，里面写入：</p>
<pre><code>@echo off
::正常开机模式
::adb reboot bootloader
::reboot模式
fastboot reboot-bootloader
ping -n 15 127.0.0.1 &gt;nul
::fastboot oem unlock
fastboot erase system
fastboot erase boot
fastboot erase recovery
fastboot erase cache
fastboot erase userdata
fastboot flash system system.img
fastboot flash boot boot.img
fastboot flash recovery recovery.img
fastboot flash cache cache.img
fastboot flash userdata userdata.img
pause
fastboot reboot
</code></pre><p>执行此bat，则刷机成功。<br>
然后刷recovery，比如</p>
<pre><code>C:\Users\ThinkPad&gt;fastboot flash recovery C:\Users\ThinkPad\Desktop\n5_6.0\twrp-3.2.2-0-hammerhead.img
</code></pre><p>进入recovery，n5这里直接手机选择进入（点击音量，到recovery再进入）。<br>
然后拷入supersu和xposed。<br>
再安装Xposed。<br>
如果是高于xpose的版本，就要结合edxposed和magisk。<br>
注意高版本9.0不要设置密码，不然twrp，recovery时要输入密码，而且输设置的也不对。<br>
然后就是安装twrp-&gt;Magisk-&gt;EdXposed-SandHook-&gt;EdXposedManager。</p>
<h1 id="xposed插件开发之hook构造函数">Xposed插件开发之hook构造函数</h1>
<h2 id="xposed插件编写">Xposed插件编写</h2>
<ol>
<li>拷贝XposedBridgeApi.jar到新建工程的libs目录。</li>
<li>修改app目录下的build.gradle文件，在androidManifest.xml中增加Xpose的相关内容。</li>
<li>新建hook类，编写hook代码</li>
<li>新建assets文件夹，在assets目录下新建文件xposed_init,在里面写上hook类的完整路径。</li>
</ol>
<h3 id="2xposed插件编写">2.Xposed插件编写</h3>
<pre><code>    &lt;meta-data android:name=&quot;xposedmodule&quot;
            android:value=&quot;true&quot;/&gt;
        &lt;meta-data android:name=&quot;xposeddescription&quot;
            android:value=&quot;模块描述&quot;/&gt;
        &lt;meta-data android:name=&quot;xposedminversion&quot;
            android:value=&quot;54&quot;/&gt;
        
</code></pre><h3 id="新建hook类编写hook代码">新建hook类，编写hook代码</h3>
<p>
        <img class="mx-auto" alt="" src="https://gitee.com/kernweak/my-blog/raw/master/img/20210106205317.png" />   
    </p>
<h3 id="新建assets文件夹在assets目录下新建文件xposed_init在里面写上hook类的完整路径">新建assets文件夹，在assets目录下新建文件xposed_init,在里面写上hook类的完整路径</h3>
<p>res文件夹下新建assets文件夹，在assets目录下新建文件xposed_init,在里面写上hook类的完整路径，里面内容为实现了IXposedHookLoadPackage接口的hook类的完整类名（可以有多个，每一个hook实现类一行）<br>

        <img class="mx-auto" alt="" src="https://gitee.com/kernweak/my-blog/raw/master/img/20210106205350.png" />   
    </p>
<h2 id="xposed的hook构造函数">xposed的hook构造函数</h2>
<p>首先是通过jadx确定包名，类名，方法名，接着使用
两个，如下，第一个需要类型，可以通过classload加载。第二个需要传入类名，ClassLoader。
然后紧接着的参数为遍参的构造函数参数，最后一个为修改构造函数的回调函数。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">   <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> Unhook <span style="color:#900;font-weight:bold">findAndHookConstructor</span><span style="color:#000;font-weight:bold">(</span>Class<span style="color:#000;font-weight:bold">&lt;</span><span style="color:#000;font-weight:bold">?</span><span style="color:#000;font-weight:bold">&gt;</span> clazz<span style="color:#000;font-weight:bold">,</span> Object<span style="color:#000;font-weight:bold">.</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000;font-weight:bold">.</span> parameterTypesAndCallback<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>parameterTypesAndCallback<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">length</span> <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> 0 <span style="color:#000;font-weight:bold">&amp;</span><span style="color:#000;font-weight:bold">&amp;</span> parameterTypesAndCallback<span style="color:#000;font-weight:bold">[</span>parameterTypesAndCallback<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">length</span> <span style="color:#000;font-weight:bold">-</span> 1<span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">instanceof</span> XC_MethodHook<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            XC_MethodHook callback <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span>XC_MethodHook<span style="color:#000;font-weight:bold">)</span>parameterTypesAndCallback<span style="color:#000;font-weight:bold">[</span>parameterTypesAndCallback<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">length</span> <span style="color:#000;font-weight:bold">-</span> 1<span style="color:#000;font-weight:bold">]</span><span style="color:#000;font-weight:bold">;</span>
            Constructor<span style="color:#000;font-weight:bold">&lt;</span><span style="color:#000;font-weight:bold">?</span><span style="color:#000;font-weight:bold">&gt;</span> m <span style="color:#000;font-weight:bold">=</span> findConstructorExact<span style="color:#000;font-weight:bold">(</span>clazz<span style="color:#000;font-weight:bold">,</span> getParameterClasses<span style="color:#000;font-weight:bold">(</span>clazz<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getClassLoader</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">,</span> parameterTypesAndCallback<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">return</span> XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">hookMethod</span><span style="color:#000;font-weight:bold">(</span>m<span style="color:#000;font-weight:bold">,</span> callback<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000;font-weight:bold">throw</span> <span style="color:#000;font-weight:bold">new</span> IllegalArgumentException<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;no callback defined&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>

    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> Unhook <span style="color:#900;font-weight:bold">findAndHookConstructor</span><span style="color:#000;font-weight:bold">(</span>String className<span style="color:#000;font-weight:bold">,</span> ClassLoader classLoader<span style="color:#000;font-weight:bold">,</span> Object<span style="color:#000;font-weight:bold">.</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000;font-weight:bold">.</span> parameterTypesAndCallback<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">return</span> findAndHookConstructor<span style="color:#000;font-weight:bold">(</span>findClass<span style="color:#000;font-weight:bold">(</span>className<span style="color:#000;font-weight:bold">,</span> classLoader<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">,</span> parameterTypesAndCallback<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><p>另外MethodHookParam参数里，获取类的返回值是this.object，不是result。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#998;font-style:italic">// public Object thisObject;
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// public Object[] args;
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// private Object result = null;
</span></code></pre></td></tr></table>
</div>
</div><p>以下是hook各种参数构造函数的代码实例：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JAVA" data-lang="JAVA"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">HookConstructors</span> <span style="color:#000;font-weight:bold">implements</span> IXposedHookLoadPackage <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">handleLoadPackage</span><span style="color:#000;font-weight:bold">(</span>XC_LoadPackage<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">LoadPackageParam</span> loadPackageParam<span style="color:#000;font-weight:bold">)</span>
            <span style="color:#000;font-weight:bold">throws</span> Throwable <span style="color:#000;font-weight:bold">{</span>
        Log<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">i</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;Xposed01&#34;</span><span style="color:#000;font-weight:bold">,</span>loadPackageParam<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">packageName</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;app packagename&#34;</span><span style="color:#000;font-weight:bold">+</span>loadPackageParam<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">packageName</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>loadPackageParam<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">packageName</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">equals</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;com.yrq.xposedhook01&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;hookConstructors&#34;</span> <span style="color:#000;font-weight:bold">+</span> loadPackageParam<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">packageName</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

            ClassLoader classLoader <span style="color:#000;font-weight:bold">=</span> loadPackageParam<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">classLoader</span><span style="color:#000;font-weight:bold">;</span>
            Class StudentClass<span style="color:#000;font-weight:bold">=</span>classLoader<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">loadClass</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;com.yrq.xposedhook01.Student&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span><span style="color:#998;font-style:italic">//
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//Student()
</span><span style="color:#998;font-style:italic"></span>            XposedHelpers<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findAndHookConstructor</span><span style="color:#000;font-weight:bold">(</span>StudentClass<span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">new</span> XC_MethodHook<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#3c5d5d;font-weight:bold">@Override</span>
                <span style="color:#000;font-weight:bold">protected</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">beforeHookedMethod</span><span style="color:#000;font-weight:bold">(</span>MethodHookParam param<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">throws</span> Throwable <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">super</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">beforeHookedMethod</span><span style="color:#000;font-weight:bold">(</span>param<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;com.yrq.XposedHook01.Student() is called!Before HookConstructor&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>

                <span style="color:#3c5d5d;font-weight:bold">@Override</span>
                <span style="color:#000;font-weight:bold">protected</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">afterHookedMethod</span><span style="color:#000;font-weight:bold">(</span>MethodHookParam param<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">throws</span> Throwable <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">super</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">afterHookedMethod</span><span style="color:#000;font-weight:bold">(</span>param<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;com.yrq.XposedHook01.Student() is called!after HookConstructor&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#998;font-style:italic">//public Student(String name2)
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">// public Object thisObject;
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//        public Object[] args;
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//        private Object result = null;
</span><span style="color:#998;font-style:italic"></span>            XposedHelpers<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findAndHookConstructor</span><span style="color:#000;font-weight:bold">(</span>StudentClass<span style="color:#000;font-weight:bold">,</span> String<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">new</span> XC_MethodHook<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#3c5d5d;font-weight:bold">@Override</span>
                <span style="color:#000;font-weight:bold">protected</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">beforeHookedMethod</span><span style="color:#000;font-weight:bold">(</span>MethodHookParam param<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">throws</span> Throwable <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">super</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">beforeHookedMethod</span><span style="color:#000;font-weight:bold">(</span>param<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    java<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">lang</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Object</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000;font-weight:bold">]</span> argobjarry<span style="color:#000;font-weight:bold">=</span>param<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">args</span><span style="color:#000;font-weight:bold">;</span>
                    String name<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">)</span>argobjarry<span style="color:#000;font-weight:bold">[</span>0<span style="color:#000;font-weight:bold">]</span><span style="color:#000;font-weight:bold">;</span>

                    XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;com.yrq.XposedHook01.Student(String) is called!Before HookConstructor&#34;</span><span style="color:#000;font-weight:bold">+</span><span style="color:#d14">&#34; student name is &#34;</span><span style="color:#000;font-weight:bold">+</span>name<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>

                <span style="color:#3c5d5d;font-weight:bold">@Override</span>
                <span style="color:#000;font-weight:bold">protected</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">afterHookedMethod</span><span style="color:#000;font-weight:bold">(</span>MethodHookParam param<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">throws</span> Throwable <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">super</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">afterHookedMethod</span><span style="color:#000;font-weight:bold">(</span>param<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

                    XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;com.yrq.XposedHook01.Student(String) is called!Before HookConstructor&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#998;font-style:italic">//  public Student(String name,String id)
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//    {
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//        this.name = name;
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//        this.id = id;
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//    }
</span><span style="color:#998;font-style:italic"></span>            XposedHelpers<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findAndHookConstructor</span><span style="color:#000;font-weight:bold">(</span>StudentClass<span style="color:#000;font-weight:bold">,</span> String<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">,</span> String<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">new</span> XC_MethodHook<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#3c5d5d;font-weight:bold">@Override</span>
                <span style="color:#000;font-weight:bold">protected</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">beforeHookedMethod</span><span style="color:#000;font-weight:bold">(</span>MethodHookParam param<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">throws</span> Throwable <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">super</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">beforeHookedMethod</span><span style="color:#000;font-weight:bold">(</span>param<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    java<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">lang</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Object</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000;font-weight:bold">]</span> argobjarry<span style="color:#000;font-weight:bold">=</span>param<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">args</span><span style="color:#000;font-weight:bold">;</span>
                    String name<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">)</span>argobjarry<span style="color:#000;font-weight:bold">[</span>0<span style="color:#000;font-weight:bold">]</span><span style="color:#000;font-weight:bold">;</span>
                    String id<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">)</span>argobjarry<span style="color:#000;font-weight:bold">[</span>1<span style="color:#000;font-weight:bold">]</span><span style="color:#000;font-weight:bold">;</span>
                    XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;com.yrq.XposedHook01.Student(String,String) is called!Before HookConstructor&#34;</span><span style="color:#000;font-weight:bold">+</span><span style="color:#d14">&#34; student name is &#34;</span><span style="color:#000;font-weight:bold">+</span>name<span style="color:#000;font-weight:bold">+</span><span style="color:#d14">&#34; id is&#34;</span><span style="color:#000;font-weight:bold">+</span>id<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>

                <span style="color:#3c5d5d;font-weight:bold">@Override</span>
                <span style="color:#000;font-weight:bold">protected</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">afterHookedMethod</span><span style="color:#000;font-weight:bold">(</span>MethodHookParam param<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">throws</span> Throwable <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">super</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">afterHookedMethod</span><span style="color:#000;font-weight:bold">(</span>param<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

                    XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;com.yrq.XposedHook01.Student(String,String) is called!Before HookConstructor&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#998;font-style:italic">//  public Student(String name,String id,int age)
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//    {
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//        this.name = name;
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//        this.id = id;
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//        this.age = age;
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//    }
</span><span style="color:#998;font-style:italic"></span>           <span style="color:#998;font-style:italic">/* XposedHelpers.findAndHookConstructor(StudentClass, String.class, String.class,int.class , new XC_MethodHook() {
</span><span style="color:#998;font-style:italic">                @Override
</span><span style="color:#998;font-style:italic">                protected void beforeHookedMethod(MethodHookParam param) throws Throwable {
</span><span style="color:#998;font-style:italic">                    super.beforeHookedMethod(param);
</span><span style="color:#998;font-style:italic">                    java.lang.Object[] argobjarry=param.args;
</span><span style="color:#998;font-style:italic">                    String name=(String)argobjarry[0];
</span><span style="color:#998;font-style:italic">                    String id=(String)argobjarry[1];
</span><span style="color:#998;font-style:italic">                    int age=(int)argobjarry[2];
</span><span style="color:#998;font-style:italic">                    XposedBridge.log(&#34;com.yrq.XposedHook01.Student(String,String,int) is called!Before HookConstructor&#34;+&#34; student name is &#34;+name+&#34; id is&#34;+id+&#34;age &#34;+age);
</span><span style="color:#998;font-style:italic">
</span><span style="color:#998;font-style:italic">                }
</span><span style="color:#998;font-style:italic">
</span><span style="color:#998;font-style:italic">                @Override
</span><span style="color:#998;font-style:italic">                protected void afterHookedMethod(MethodHookParam param) throws Throwable {
</span><span style="color:#998;font-style:italic">                    super.afterHookedMethod(param);
</span><span style="color:#998;font-style:italic">
</span><span style="color:#998;font-style:italic">                    XposedBridge.log(&#34;com.yrq.XposedHook01.Student(String,String,int) is called!Before HookConstructor&#34;);
</span><span style="color:#998;font-style:italic">                }
</span><span style="color:#998;font-style:italic">            });
</span><span style="color:#998;font-style:italic">
</span><span style="color:#998;font-style:italic">            */</span>
            XposedHelpers<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findAndHookConstructor</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;com.yrq.xposedhook01.Student&#34;</span><span style="color:#000;font-weight:bold">,</span>loadPackageParam<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">classLoader</span><span style="color:#000;font-weight:bold">,</span>String<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">,</span> String<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">,</span><span style="color:#458;font-weight:bold">int</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span> <span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">new</span> XC_MethodHook<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#3c5d5d;font-weight:bold">@Override</span>
                <span style="color:#000;font-weight:bold">protected</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">beforeHookedMethod</span><span style="color:#000;font-weight:bold">(</span>MethodHookParam param<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">throws</span> Throwable <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">super</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">beforeHookedMethod</span><span style="color:#000;font-weight:bold">(</span>param<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    java<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">lang</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Object</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000;font-weight:bold">]</span> argobjarry<span style="color:#000;font-weight:bold">=</span>param<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">args</span><span style="color:#000;font-weight:bold">;</span>

                    <span style="color:#458;font-weight:bold">int</span> age<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span><span style="color:#000;font-weight:bold">)</span>argobjarry<span style="color:#000;font-weight:bold">[</span>2<span style="color:#000;font-weight:bold">]</span><span style="color:#000;font-weight:bold">;</span>
                    argobjarry<span style="color:#000;font-weight:bold">[</span>1<span style="color:#000;font-weight:bold">]</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;9547&#34;</span><span style="color:#000;font-weight:bold">;</span>
                    argobjarry<span style="color:#000;font-weight:bold">[</span>0<span style="color:#000;font-weight:bold">]</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;gecong&#34;</span><span style="color:#000;font-weight:bold">;</span>
                    String name<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">)</span>argobjarry<span style="color:#000;font-weight:bold">[</span>0<span style="color:#000;font-weight:bold">]</span><span style="color:#000;font-weight:bold">;</span>
                    String id<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">)</span>argobjarry<span style="color:#000;font-weight:bold">[</span>1<span style="color:#000;font-weight:bold">]</span><span style="color:#000;font-weight:bold">;</span>
                    XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;com.yrq.XposedHook01.Student(String,String,int) is called!Before HookConstructor&#34;</span><span style="color:#000;font-weight:bold">+</span><span style="color:#d14">&#34; student name is &#34;</span><span style="color:#000;font-weight:bold">+</span>name<span style="color:#000;font-weight:bold">+</span><span style="color:#d14">&#34; id is&#34;</span><span style="color:#000;font-weight:bold">+</span>id<span style="color:#000;font-weight:bold">+</span><span style="color:#d14">&#34;age &#34;</span><span style="color:#000;font-weight:bold">+</span>age<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

                <span style="color:#000;font-weight:bold">}</span>

                <span style="color:#3c5d5d;font-weight:bold">@Override</span>
                <span style="color:#000;font-weight:bold">protected</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">afterHookedMethod</span><span style="color:#000;font-weight:bold">(</span>MethodHookParam param<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">throws</span> Throwable <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">super</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">afterHookedMethod</span><span style="color:#000;font-weight:bold">(</span>param<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

                    XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;com.yrq.XposedHook01.Student(String,String,int) is called!Before HookConstructor&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="xposed插件开发之修改属性">Xposed插件开发之修改属性</h1>
<p>前面的方法是通过hook类的构造函数，修改变量，现在是通过类或者对象，修改类或者对象的属性。</p>
<ol>
<li>使用java反射修改属性</li>
<li>使用Xposed的API修改属性<br>
第一种生成的hook类也是运行在当前进程的用户空间的，跟app自己的dex也都是在一起的，所以可用反射。<br>
注意点如果使用第一种使用java反射修改属性，非public时修改前不设置取消权限修改会报错，第二种使用Xposed的API修改属性则正常</li>
</ol>
<pre><code>  teacherField.setAccessible(true);
</code></pre><h1 id="课时4xposed插件开发之hook一般函数">课时4：Xposed插件开发之hook一般函数</h1>
<ul>
<li>一般Java函数的hook</li>
<li>内部类中函数的hook</li>
<li>匿名内部类函数的hook</li>
<li>类中JNI函数的hook</li>
</ul>
<p>都可用findAndHookMethod。</p>
<h1 id="xposed插件开发之主动调用类函数">Xposed插件开发之主动调用类函数</h1>
<ol>
<li>使用java反射完成对类函数的调用</li>
<li>使用Xposed的API完成对类函数的调用</li>
</ol>
<h2 id="使用java反射完成对类函数的调用">使用java反射完成对类函数的调用</h2>
<p>对于类中静态函数，直接调用即可<br>
对于非静态函数需要先得到实例，再调用</p>
<h3 id="静态函数主动调用">静态函数主动调用</h3>
<p>对于类中静态函数，关于public和private的Xposed主动调用区别是private要关闭权限检查即</p>
<blockquote>
<p>.setAccessible(true);</p>
</blockquote>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JAVA" data-lang="JAVA"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">HookActiveInvoke</span> <span style="color:#000;font-weight:bold">implements</span> IXposedHookLoadPackage <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">handleLoadPackage</span><span style="color:#000;font-weight:bold">(</span>XC_LoadPackage<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">LoadPackageParam</span> loadPackageParam<span style="color:#000;font-weight:bold">)</span>
            <span style="color:#000;font-weight:bold">throws</span> Throwable <span style="color:#000;font-weight:bold">{</span>
        Log<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">i</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;Xposed01&#34;</span><span style="color:#000;font-weight:bold">,</span>loadPackageParam<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">packageName</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;app packagename&#34;</span><span style="color:#000;font-weight:bold">+</span>loadPackageParam<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">packageName</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>loadPackageParam<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">packageName</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">equals</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;com.yrq.xposedhook01&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;YRQ&#34;</span> <span style="color:#000;font-weight:bold">+</span> loadPackageParam<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">packageName</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

            <span style="color:#998;font-style:italic">//使用反射完成对静态函数的调用
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//  public static String publicstaticfunc(String arg1,int arg2){
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//        String result=privatestaticfunc(&#34;privatestaticfunc&#34;,99);
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//        Log.i(&#34;Xposed&#34;,&#34;publicstaticfunc is called&#34;);
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//        return arg1+&#34;---&#34;+arg2+&#34;---&#34;+result;
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//    }
</span><span style="color:#998;font-style:italic"></span>            ClassLoader classLoader<span style="color:#000;font-weight:bold">=</span>loadPackageParam<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">classLoader</span><span style="color:#000;font-weight:bold">;</span>
            Class StudentCLass<span style="color:#000;font-weight:bold">=</span>classLoader<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">loadClass</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;com.yrq.xposedhook01.Student&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

            Method publicstaticfunc_Method<span style="color:#000;font-weight:bold">=</span>StudentCLass<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getDeclaredMethod</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;publicstaticfunc&#34;</span><span style="color:#000;font-weight:bold">,</span>String<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">,</span><span style="color:#458;font-weight:bold">int</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            publicstaticfunc_Method<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">invoke</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;publicstaticfunc_Method InvokeByXposed&#34;</span><span style="color:#000;font-weight:bold">,</span>100<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#998;font-style:italic">//    private static String privatestaticfunc(String arg1,int arg2){
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//        Log.i(&#34;Xposed&#34;,&#34;privatestaticfunc is called&#34;);
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//        return arg1+&#34;---&#34;+arg2;
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//    }
</span><span style="color:#998;font-style:italic"></span>
            
            Method privatestaticfunc_Method<span style="color:#000;font-weight:bold">=</span>StudentCLass<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getDeclaredMethod</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;privatestaticfunc&#34;</span><span style="color:#000;font-weight:bold">,</span>String<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">,</span><span style="color:#458;font-weight:bold">int</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            privatestaticfunc_Method<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setAccessible</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            privatestaticfunc_Method<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">invoke</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;privatestaticfunc_Method InvokeByXposed&#34;</span><span style="color:#000;font-weight:bold">,</span>101<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="非静态函数主动调用">非静态函数主动调用</h3>
<p>有2种思路，自己调用构造函数创建一个对象，调用函数（这里可以有两种操作：使用反射或者XposedAPI）。</p>
<ol>
<li>另外就是hook函数，这里可以hook两种函数  可以hook构造函数，在构造函数结束时thisObject就得到对象</li>
<li>者hook对象被调用的一般函数，得到此时的对象。</li>
</ol>
<h4 id="自己调用构造函数创建一个对象调用函数">自己调用构造函数创建一个对象，调用函数</h4>
<h5 id="使用反射自己创建对象方式">使用反射自己创建对象方式</h5>
<p>使用反射，得到对象后调用</p>
<pre><code> //非静态需要得到对象然后调用
            Method publicfunc_Method=StudentCLass.getDeclaredMethod(&quot;publicfunc&quot;,String.class,int.class);

            //要得到对象，就通过反射，得到构造函数，调用创建实例对象
            //public Student(String name,String id)
            //    {
            //        this.name = name;
            //        this.id = id;
            //    }

            Constructor StuCon=StudentCLass.getDeclaredConstructor(String.class,String.class);
            Object StuObj=StuCon.newInstance(&quot;InstanceByXposed&quot;,&quot;112233&quot;);

            publicfunc_Method.invoke(StuObj,&quot;publicfuncInvockedByXposed&quot;,332211);
            //    private String privatefunc(String arg1,int arg2){
            //        Log.i(&quot;Xposed&quot;,&quot;privatefunc is called!---&quot;+arg1+&quot;---&quot;+arg2);
            //        return arg1+&quot;---&quot;+arg2;
            //    }

            Method privatefunc_Method=StudentCLass.getDeclaredMethod(&quot;privatefunc&quot;,String.class,int.class);

            privatefunc_Method.setAccessible(true);
            String privatefunc_result= (String) publicfunc_Method.invoke(StuObj,&quot;privatefuncInvockedByXposed&quot;,333333);

            XposedBridge.log(&quot;privatefunc activeInvokeByXposed&quot;+privatefunc_result);
</code></pre><h5 id="使用xposed的api操作自己创建对象方式">使用Xposed的API操作自己创建对象方式</h5>
<p>XposedHelpers.callStaticMethod()来调用，有两个此函数，区别为有一个有指定参数列表，实现重载的函数调用</p>
<pre><code>    java.lang.Class&lt;?&gt;[]parameterTypes={String.class,int.class};
            XposedHelpers.callStaticMethod(StudentCLass,&quot;publicstaticfunc&quot;,parameterTypes,&quot;XposedHelpers.callStaticMethod&quot;,101);


            Object objStudentByXposed=XposedHelpers.newInstance(StudentCLass,&quot;XposedHelpers.newInstance&quot;,&quot;444444&quot;);
            String result1=(String)XposedHelpers.callMethod(objStudentByXposed,&quot;publicfunc&quot;,&quot;publicfunc is call by XposedHelpers.callMethod&quot;,123);
            XposedBridge.log(&quot;publicfunc XposedHelpers.callMethod result----&quot;+result1);

        }
    }
</code></pre><h4 id="通过hook以有函数方式">通过hook以有函数方式</h4>
<p>这里是hook构造函数或者hook某一个类的非静态函数<br>
假如是已经有对象了，已经实例化了。一种思路是hook构造函数，就可以通过参数拿到thisobject</p>
<pre><code> XposedHelpers.findAndHookConstructor(StudentCLass, String.class, String.class, new XC_MethodHook() {
                @Override
                protected void beforeHookedMethod(MethodHookParam param) throws Throwable {
                    super.beforeHookedMethod(param);
                    XposedBridge.log(&quot;Student(String,String) is called beforeHookMethod&quot;);
                }

                @Override
                protected void afterHookedMethod(MethodHookParam param) throws Throwable {
                    super.afterHookedMethod(param);
                    Object cstudent=param.thisObject;
                    String result3=(String)XposedHelpers.callMethod(cstudent,&quot;privatefunc&quot;,&quot;cstudent privatefunc&quot;,8888);
                    XposedBridge.log(result3);

                }
            });
</code></pre><p>另一种思路是观察，如果都调用了某个非静态函数，就对这个函数Hook，就可以得到他的对象，然后调用对象的其他函数。</p>
<pre><code>XposedHelpers.findAndHookMethod(StudentCLass, &quot;getNickname&quot;, new XC_MethodHook() {
                @Override
                protected void beforeHookedMethod(MethodHookParam param) throws Throwable {
                    super.beforeHookedMethod(param);
                    Object obj =param.thisObject;
                    XposedHelpers.callMethod(obj,&quot;publicfunc&quot;,&quot;publicfunc is callec by getNickname &quot;,7766);
                    XposedBridge.log(&quot;getNickname beforeHookedMethod-&gt;&quot;+obj);

                }

                @Override
                protected void afterHookedMethod(MethodHookParam param) throws Throwable {
                    super.afterHookedMethod(param);
                    Object obj =param.thisObject;

                    XposedHelpers.callMethod(obj,&quot;publicfunc&quot;,&quot;publicfunc is callec by getNickname &quot;,7766);

                    XposedBridge.log(&quot;getNickname afterHookedMethod-&gt;&quot;+obj);

                }
            });
</code></pre><h1 id="xposed插件开发之加壳app的hook处理">Xposed插件开发之加壳APP的Hook处理</h1>
<p>因为app的Application类中的attachBaseContext和onCreate这两个函数是最先获取执行权进行代码执行的，加壳APP一般是在这两个函数进行对原dex的初始化。<br>

        <img class="mx-auto" alt="" src="https://gitee.com/kernweak/my-blog/raw/master/img/20210106205443.png" />   
    <br>
这里StubApp就依旧还有这两个函数。<br>
这里就是利用反射进行各种操作，从这里hook就知道加载了哪些类。<br>

        <img class="mx-auto" alt="" src="https://gitee.com/kernweak/my-blog/raw/master/img/20210106205520.png" />   
     <br>
(以下要正常工作，app中classloader不能直接继承classloader)我们可以看到PathClassLoader继承自BaseDexClassLoader，其中有个属性</p>
<blockquote>
<p>private final DexPathList pathList;</p>
</blockquote>
<p>
        <img class="mx-auto" alt="" src="https://gitee.com/kernweak/my-blog/raw/master/img/20210106205557.png" />   
    <br>
这里DexPathList类种有个属性</p>
<blockquote>
<p>private Element[] dexElements;</p>
</blockquote>
<p>记录了所有加载的dex<br>
每一个dex都有一个dexFile对象<br>

        <img class="mx-auto" alt="" src="https://gitee.com/kernweak/my-blog/raw/master/img/20210106205631.png" />   
     <br>
Dexfile如下:</p>
<p>
        <img class="mx-auto" alt="" src="https://gitee.com/kernweak/my-blog/raw/master/img/20210106205654.png" />   
     <br>
立面有很多API如获取类列表：getClassNameList(df.mCookie);这里要拿到mCookie<br>
下面就是代码流程：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JAVA" data-lang="JAVA"><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">HookJava</span> <span style="color:#000;font-weight:bold">implements</span> IXposedHookLoadPackage <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">GetClassLoaderClasslist</span><span style="color:#000;font-weight:bold">(</span>ClassLoader classloader<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">{</span>
        <span style="color:#998;font-style:italic">//首先通过classloader的反射拿到pathlist, private final DexPathList pathList;
</span><span style="color:#998;font-style:italic"></span>        XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;start dealwith classloader:&#34;</span><span style="color:#000;font-weight:bold">+</span>classloader<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        Object pathListObj<span style="color:#000;font-weight:bold">=</span>XposedHelpers<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getObjectField</span><span style="color:#000;font-weight:bold">(</span>classloader<span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;pathList&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#998;font-style:italic">//接下来拿private Element[] dexElements;
</span><span style="color:#998;font-style:italic"></span>        Object<span style="color:#000;font-weight:bold">[</span><span style="color:#000;font-weight:bold">]</span> dexElementsObj<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(</span>Object<span style="color:#000;font-weight:bold">[</span><span style="color:#000;font-weight:bold">]</span><span style="color:#000;font-weight:bold">)</span>XposedHelpers<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getObjectField</span><span style="color:#000;font-weight:bold">(</span>pathListObj<span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;dexElements&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#998;font-style:italic">//每一个dexElements数组成员都拥有dexfile对象。
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span>Object i<span style="color:#000;font-weight:bold">:</span>dexElementsObj<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">{</span>
            <span style="color:#998;font-style:italic">//对数组进行遍历，取出每个dexfile对象
</span><span style="color:#998;font-style:italic"></span>            Object dexFileObj<span style="color:#000;font-weight:bold">=</span>XposedHelpers<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getObjectField</span><span style="color:#000;font-weight:bold">(</span>i<span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;dexFile&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#998;font-style:italic">//通过dexfile的此APIgetClassNameList(df.mCookie);获取类列表
</span><span style="color:#998;font-style:italic"></span>            Object mCookieObj<span style="color:#000;font-weight:bold">=</span>XposedHelpers<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getObjectField</span><span style="color:#000;font-weight:bold">(</span>dexFileObj<span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;mCookie&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#998;font-style:italic">//private static native String[] getClassNameList(Object cookie);
</span><span style="color:#998;font-style:italic"></span>            Class DexFileClass<span style="color:#000;font-weight:bold">=</span>XposedHelpers<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findClass</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;dalvik.system.DexFile&#34;</span><span style="color:#000;font-weight:bold">,</span>classloader<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

            String<span style="color:#000;font-weight:bold">[</span><span style="color:#000;font-weight:bold">]</span> classList<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">[</span><span style="color:#000;font-weight:bold">]</span><span style="color:#000;font-weight:bold">)</span>XposedHelpers<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">callStaticMethod</span><span style="color:#000;font-weight:bold">(</span>DexFileClass<span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;getClassNameList&#34;</span><span style="color:#000;font-weight:bold">,</span>mCookieObj<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span>String classname<span style="color:#000;font-weight:bold">:</span>classList<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">{</span>
                XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span>dexFileObj<span style="color:#000;font-weight:bold">+</span><span style="color:#d14">&#34;---&#34;</span><span style="color:#000;font-weight:bold">+</span>classname<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}</span>
        XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;end dealwith classloader:&#34;</span><span style="color:#000;font-weight:bold">+</span>classloader<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">handleLoadPackage</span><span style="color:#000;font-weight:bold">(</span>XC_LoadPackage<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">LoadPackageParam</span> loadPackageParam<span style="color:#000;font-weight:bold">)</span>
            <span style="color:#000;font-weight:bold">throws</span> Throwable <span style="color:#000;font-weight:bold">{</span>
        Log<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">i</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;HookJava&#34;</span><span style="color:#000;font-weight:bold">,</span>loadPackageParam<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">packageName</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;HookJava app packagename&#34;</span><span style="color:#000;font-weight:bold">+</span>loadPackageParam<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">packageName</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>loadPackageParam<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">packageName</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">equals</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;com.kanxue.xposedhook01&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;YRQ&#34;</span> <span style="color:#000;font-weight:bold">+</span> loadPackageParam<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">packageName</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

            <span style="color:#998;font-style:italic">//public static Unhook findAndHookMethod(String className, ClassLoader classLoader, String methodName, Object... parameterTypesAndCallback) {
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//        return findAndHookMethod(findClass(className, classLoader), methodName, parameterTypesAndCallback);
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//    }
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//    public static Unhook findAndHookMethod(Class&lt;?&gt; clazz, String methodName, Object... parameterTypesAndCallback) {
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//        if (parameterTypesAndCallback.length != 0 &amp;&amp; parameterTypesAndCallback[parameterTypesAndCallback.length - 1] instanceof XC_MethodHook) {
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//            XC_MethodHook callback = (XC_MethodHook)parameterTypesAndCallback[parameterTypesAndCallback.length - 1];
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//            Method m = findMethodExact(clazz, methodName, getParameterClasses(clazz.getClassLoader(), parameterTypesAndCallback));
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//            return XposedBridge.hookMethod(m, callback);
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//        } else {
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//            throw new IllegalArgumentException(&#34;no callback defined&#34;);
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//        }
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//    }
</span><span style="color:#998;font-style:italic"></span>
            ClassLoader classLoader<span style="color:#000;font-weight:bold">=</span>loadPackageParam<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">classLoader</span><span style="color:#000;font-weight:bold">;</span>

            XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;loadPackageParam.classLoader-&gt;&#34;</span><span style="color:#000;font-weight:bold">+</span>classLoader<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            GetClassLoaderClasslist<span style="color:#000;font-weight:bold">(</span>classLoader<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

            ClassLoader parent<span style="color:#000;font-weight:bold">=</span>classLoader<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getParent</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">while</span><span style="color:#000;font-weight:bold">(</span>parent<span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">{</span>
                XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;parent-&gt;&#34;</span><span style="color:#000;font-weight:bold">+</span>parent<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#998;font-style:italic">//因为bootclassloader不是继承自baseclassloader,所以要过滤掉它
</span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span>parent<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">toString</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">contains</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;BootClassLoader&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">{</span>

                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">else</span><span style="color:#000;font-weight:bold">{</span>
                    GetClassLoaderClasslist<span style="color:#000;font-weight:bold">(</span>parent<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>

                parent<span style="color:#000;font-weight:bold">=</span>parent<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getParent</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>
<span style="color:#998;font-style:italic">/*
</span><span style="color:#998;font-style:italic">* 2021-01-04 05:46:27.788 4568-4568/com.kanxue.xposedhook01 I/EdXposed-Bridge: YRQcom.kanxue.xposedhook01
</span><span style="color:#998;font-style:italic">2021-01-04 05:46:27.789 4568-4568/com.kanxue.xposedhook01 I/EdXposed-Bridge: loadPackageParam.classLoader-&gt;dalvik.system.PathClassLoader[DexPathList[[zip file &#34;/data/app/com.kanxue.xposedhook01-zeef8np0YDodFo6lhfYTyw==/base.apk&#34;],nativeLibraryDirectories=[/data/app/com.kanxue.xposedhook01-zeef8np0YDodFo6lhfYTyw==/lib/arm64, /system/lib64, /vendor/lib64]]]
</span><span style="color:#998;font-style:italic">2021-01-04 05:46:27.789 4568-4568/com.kanxue.xposedhook01 I/EdXposed-Bridge: parent-&gt;java.lang.BootClassLoader@69a83b6
</span><span style="color:#998;font-style:italic">* */</span>

            Class StuClass<span style="color:#000;font-weight:bold">=</span>classLoader<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">loadClass</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;com.kanxue.xposedhook01.Student&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

            Class StuClassByXposed<span style="color:#000;font-weight:bold">=</span>XposedHelpers<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findClass</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;com.kanxue.xposedhook01.Student&#34;</span><span style="color:#000;font-weight:bold">,</span>classLoader<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

            <span style="color:#998;font-style:italic">//public static String publicstaticfunc(String arg1,int arg2){
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//        String result=privatestaticfunc(&#34;privatestaticfunc&#34;,99);
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//        return arg1+&#34;---&#34;+arg2+&#34;---&#34;+result;
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//    }
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//    private static String privatestaticfunc(String arg1,int arg2){
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//        return arg1+&#34;---&#34;+arg2;
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//    }
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//    public String publicfunc(String arg1,int arg2){
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//        String result=privatefunc(&#34;privatefunc&#34;,96);
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//        return arg1+&#34;---&#34;+arg2+&#34;---&#34;+result;
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//    }
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//    private String privatefunc(String arg1,int arg2){
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//        return arg1+&#34;---&#34;+arg2;
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//    }
</span><span style="color:#998;font-style:italic"></span>


            XposedHelpers<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findAndHookMethod</span><span style="color:#000;font-weight:bold">(</span>StuClass<span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;publicstaticfunc&#34;</span><span style="color:#000;font-weight:bold">,</span>String<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">,</span><span style="color:#458;font-weight:bold">int</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">new</span> XC_MethodHook<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#3c5d5d;font-weight:bold">@Override</span>
                <span style="color:#000;font-weight:bold">protected</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">beforeHookedMethod</span><span style="color:#000;font-weight:bold">(</span>MethodHookParam param<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">throws</span> Throwable <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">super</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">beforeHookedMethod</span><span style="color:#000;font-weight:bold">(</span>param<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

                    Object<span style="color:#000;font-weight:bold">[</span><span style="color:#000;font-weight:bold">]</span> objectarray<span style="color:#000;font-weight:bold">=</span>param<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">args</span><span style="color:#000;font-weight:bold">;</span>
                    String arg0<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">)</span>objectarray<span style="color:#000;font-weight:bold">[</span>0<span style="color:#000;font-weight:bold">]</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#458;font-weight:bold">int</span> arg1<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span><span style="color:#000;font-weight:bold">)</span>objectarray<span style="color:#000;font-weight:bold">[</span>1<span style="color:#000;font-weight:bold">]</span><span style="color:#000;font-weight:bold">;</span>
                    objectarray<span style="color:#000;font-weight:bold">[</span>0<span style="color:#000;font-weight:bold">]</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;changebyxpsoedjava&#34;</span><span style="color:#000;font-weight:bold">;</span>
                    objectarray<span style="color:#000;font-weight:bold">[</span>1<span style="color:#000;font-weight:bold">]</span><span style="color:#000;font-weight:bold">=</span>10086<span style="color:#000;font-weight:bold">;</span>

                    XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;beforeHookedMethod publicstaticfunc-&gt;arg0:&#34;</span><span style="color:#000;font-weight:bold">+</span>arg0<span style="color:#000;font-weight:bold">+</span><span style="color:#d14">&#34;---arg1:&#34;</span><span style="color:#000;font-weight:bold">+</span>arg1<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

                <span style="color:#000;font-weight:bold">}</span>

                <span style="color:#3c5d5d;font-weight:bold">@Override</span>
                <span style="color:#000;font-weight:bold">protected</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">afterHookedMethod</span><span style="color:#000;font-weight:bold">(</span>MethodHookParam param<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">throws</span> Throwable <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">super</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">afterHookedMethod</span><span style="color:#000;font-weight:bold">(</span>param<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

                    String result<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">)</span>param<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getResult</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    param<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setResult</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;changebyxposed-&gt;afterHookedMethod&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

                    XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;beforeHookedMethod publicstaticfunc-&gt;result:&#34;</span><span style="color:#000;font-weight:bold">+</span>result<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            Class StudentPerson<span style="color:#000;font-weight:bold">=</span>XposedHelpers<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findClass</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;com.kanxue.xposedhook01.Student$person&#34;</span><span style="color:#000;font-weight:bold">,</span>classLoader<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            XposedHelpers<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findAndHookMethod</span><span style="color:#000;font-weight:bold">(</span>StudentPerson<span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;getName&#34;</span><span style="color:#000;font-weight:bold">,</span> String<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">new</span> XC_MethodHook<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#3c5d5d;font-weight:bold">@Override</span>
                <span style="color:#000;font-weight:bold">protected</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">beforeHookedMethod</span><span style="color:#000;font-weight:bold">(</span>MethodHookParam param<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">throws</span> Throwable <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">super</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">beforeHookedMethod</span><span style="color:#000;font-weight:bold">(</span>param<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;beforeHookedMethod-&gt;getName&#34;</span><span style="color:#000;font-weight:bold">+</span>param<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">args</span><span style="color:#000;font-weight:bold">[</span>0<span style="color:#000;font-weight:bold">]</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>

                <span style="color:#3c5d5d;font-weight:bold">@Override</span>
                <span style="color:#000;font-weight:bold">protected</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">afterHookedMethod</span><span style="color:#000;font-weight:bold">(</span>MethodHookParam param<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">throws</span> Throwable <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">super</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">afterHookedMethod</span><span style="color:#000;font-weight:bold">(</span>param<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;afterHookedMethod-&gt;getName&#34;</span><span style="color:#000;font-weight:bold">+</span>param<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getResult</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><p>下面就是结果：</p>
<pre><code>01-04 23:43:42.212 3434-3434/com.kanxue.xposedhook01 I/HookJava: com.kanxue.xposedhook01
01-04 23:43:42.212 3434-3434/com.kanxue.xposedhook01 I/Xposed: HookJava app packagenamecom.kanxue.xposedhook01
01-04 23:43:42.212 3434-3434/com.kanxue.xposedhook01 I/Xposed: YRQcom.kanxue.xposedhook01
01-04 23:43:42.212 3434-3434/com.kanxue.xposedhook01 I/Xposed: loadPackageParam.classLoader-&gt;dalvik.system.PathClassLoader[DexPathList[[zip file &quot;/data/app/com.kanxue.xposedhook01-1/base.apk&quot;],nativeLibraryDirectories=[/data/app/com.kanxue.xposedhook01-1/lib/arm, /vendor/lib, /system/lib]]]
01-04 23:43:42.212 3434-3434/com.kanxue.xposedhook01 I/Xposed: start dealwith classloader:dalvik.system.PathClassLoader[DexPathList[[zip file &quot;/data/app/com.kanxue.xposedhook01-1/base.apk&quot;],nativeLibraryDirectories=[/data/app/com.kanxue.xposedhook01-1/lib/arm, /vendor/lib, /system/lib]]]
01-04 23:43:42.221 3434-3434/com.kanxue.xposedhook01 I/Xposed: /data/app/com.kanxue.xposedhook01-1/base.apk---com.qihoo.util.Configuration
01-04 23:43:42.221 3434-3434/com.kanxue.xposedhook01 I/Xposed: /data/app/com.kanxue.xposedhook01-1/base.apk---com.qihoo.util.DtcLoader
01-04 23:43:42.221 3434-3434/com.kanxue.xposedhook01 I/Xposed: /data/app/com.kanxue.xposedhook01-1/base.apk---com.qihoo.util.QHDialog
01-04 23:43:42.221 3434-3434/com.kanxue.xposedhook01 I/Xposed: /data/app/com.kanxue.xposedhook01-1/base.apk---com.qihoo.util.ᵢˋ
01-04 23:43:42.221 3434-3434/com.kanxue.xposedhook01 I/Xposed: /data/app/com.kanxue.xposedhook01-1/base.apk---com.qihoo.util.ᵢˎ
01-04 23:43:42.221 3434-3434/com.kanxue.xposedhook01 I/Xposed: /data/app/com.kanxue.xposedhook01-1/base.apk---com.qihoo.util.ᵢˏ
01-04 23:43:42.221 3434-3434/com.kanxue.xposedhook01 I/Xposed: /data/app/com.kanxue.xposedhook01-1/base.apk---com.stub.StubApp
01-04 23:43:42.222 3434-3434/com.kanxue.xposedhook01 I/Xposed: end dealwith classloader:dalvik.system.PathClassLoader[DexPathList[[zip file &quot;/data/app/com.kanxue.xposedhook01-1/base.apk&quot;],nativeLibraryDirectories=[/data/app/com.kanxue.xposedhook01-1/lib/arm, /vendor/lib, /system/lib]]]
01-04 23:43:42.222 3434-3434/com.kanxue.xposedhook01 I/Xposed: parent-&gt;dalvik.system.PathClassLoader[DexPathList[[dex file &quot;/data/dalvik-cache/xposed_XResourcesSuperClass.dex&quot;, dex file &quot;/data/dalvik-cache/xposed_XTypedArraySuperClass.dex&quot;],nativeLibraryDirectories=[/vendor/lib, /system/lib]]]
01-04 23:43:42.223 3434-3434/com.kanxue.xposedhook01 I/Xposed: start dealwith classloader:dalvik.system.PathClassLoader[DexPathList[[dex file &quot;/data/dalvik-cache/xposed_XResourcesSuperClass.dex&quot;, dex file &quot;/data/dalvik-cache/xposed_XTypedArraySuperClass.dex&quot;],nativeLibraryDirectories=[/vendor/lib, /system/lib]]]
01-04 23:43:42.223 3434-3434/com.kanxue.xposedhook01 I/Xposed: /data/dalvik-cache/xposed_XResourcesSuperClass.dex---xposed.dummy.XResourcesSuperClass
01-04 23:43:42.223 3434-3434/com.kanxue.xposedhook01 I/Xposed: /data/dalvik-cache/xposed_XTypedArraySuperClass.dex---xposed.dummy.XTypedArraySuperClass
01-04 23:43:42.223 3434-3434/com.kanxue.xposedhook01 I/Xposed: end dealwith classloader:dalvik.system.PathClassLoader[DexPathList[[dex file &quot;/data/dalvik-cache/xposed_XResourcesSuperClass.dex&quot;, dex file &quot;/data/dalvik-cache/xposed_XTypedArraySuperClass.dex&quot;],nativeLibraryDirectories=[/vendor/lib, /system/lib]]]
01-04 23:43:42.223 3434-3434/com.kanxue.xposedhook01 I/Xposed: parent-&gt;java.lang.BootClassLoader@ff4dd1
</code></pre><p>可见并没有Student类，因为在attachBaseContext和onCreate.<br>
onCreate之间进行的壳操作，onCreate之后已经解密，所以hook此函数onCreate。<br>
此函数是onCreate在StubApp类里。<br>
在hook了onCreate函数之后，为了获取classlaoder，需要同过一步步反射，需要找到framework的ActivityThread。
注意，入过没有获取成功类列表，说明BaseDexClassLoader非继承ClassLoader ，所以没有private final DexPathList pathList参数<br>

        <img class="mx-auto" alt="" src="https://gitee.com/kernweak/my-blog/raw/master/img/20210106205726.png" />   
    </p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JAVA" data-lang="JAVA">   <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> Object <span style="color:#900;font-weight:bold">invokeStaticMethod</span><span style="color:#000;font-weight:bold">(</span>String class_name<span style="color:#000;font-weight:bold">,</span>
                                             String method_name<span style="color:#000;font-weight:bold">,</span> Class<span style="color:#000;font-weight:bold">[</span><span style="color:#000;font-weight:bold">]</span> pareTyple<span style="color:#000;font-weight:bold">,</span> Object<span style="color:#000;font-weight:bold">[</span><span style="color:#000;font-weight:bold">]</span> pareVaules<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
            Class obj_class <span style="color:#000;font-weight:bold">=</span> Class<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">forName</span><span style="color:#000;font-weight:bold">(</span>class_name<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            Method method<span style="color:#000;font-weight:bold">=</span> obj_class<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMethod</span><span style="color:#000;font-weight:bold">(</span>method_name<span style="color:#000;font-weight:bold">,</span> pareTyple<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">return</span> method<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">invoke</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span> pareVaules<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>Exception e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">;</span>

    <span style="color:#000;font-weight:bold">}</span>


    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> Object <span style="color:#900;font-weight:bold">getFieldOjbect</span><span style="color:#000;font-weight:bold">(</span>String class_name<span style="color:#000;font-weight:bold">,</span> Object obj<span style="color:#000;font-weight:bold">,</span>
                                        String filedName<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
            Class obj_class <span style="color:#000;font-weight:bold">=</span> Class<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">forName</span><span style="color:#000;font-weight:bold">(</span>class_name<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            Field field <span style="color:#000;font-weight:bold">=</span> obj_class<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getDeclaredField</span><span style="color:#000;font-weight:bold">(</span>filedName<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            field<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setAccessible</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">return</span> field<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span>obj<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>Exception e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">;</span>

    <span style="color:#000;font-weight:bold">}</span>

    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> ClassLoader <span style="color:#900;font-weight:bold">getClassloader</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">{</span>
        ClassLoader resultClassloader<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">;</span>
        Object currentActivityThread<span style="color:#000;font-weight:bold">=</span>invokeStaticMethod<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;android.app.ActivityThread&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;currentActivityThread&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000;font-weight:bold">new</span> Class<span style="color:#000;font-weight:bold">[</span><span style="color:#000;font-weight:bold">]</span><span style="color:#000;font-weight:bold">{</span><span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000;font-weight:bold">new</span> Object<span style="color:#000;font-weight:bold">[</span><span style="color:#000;font-weight:bold">]</span><span style="color:#000;font-weight:bold">{</span><span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        Object mBoundApplication<span style="color:#000;font-weight:bold">=</span>getFieldOjbect<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;android.app.ActivityThread&#34;</span><span style="color:#000;font-weight:bold">,</span>currentActivityThread<span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;mBoundApplication&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        Application mInitalApplication<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(</span>Application<span style="color:#000;font-weight:bold">)</span>getFieldOjbect<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;android.app.ActivityThread&#34;</span><span style="color:#000;font-weight:bold">,</span>currentActivityThread<span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;mInitalApplication&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        Object loadedApkInfo<span style="color:#000;font-weight:bold">=</span>getFieldOjbect<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;android.app.ActivityThread$AppBindData&#34;</span><span style="color:#000;font-weight:bold">,</span>mBoundApplication<span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;info&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        Application mApplication <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span>Application<span style="color:#000;font-weight:bold">)</span>getFieldOjbect<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;android.app.LoadedApk&#34;</span><span style="color:#000;font-weight:bold">,</span>loadedApkInfo<span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;mApplication&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        resultClassloader<span style="color:#000;font-weight:bold">=</span>mApplication<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getClassLoader</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        
</code></pre></td></tr></table>
</div>
</div><p>以下就是完整代码</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">136
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">137
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">138
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">139
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">140
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">141
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">142
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">143
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">144
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">145
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">146
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">147
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">148
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">149
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">150
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">151
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">152
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">153
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">154
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">155
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">156
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">157
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">158
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">159
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">160
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">161
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">162
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">163
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">164
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">165
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">166
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">167
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">168
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">169
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">170
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">171
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">172
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">173
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">174
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">175
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">176
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">177
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">178
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">179
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">180
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">181
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">182
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">183
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">184
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">185
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">186
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">187
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">188
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">189
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">190
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">191
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">192
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">193
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">194
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">195
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">196
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">197
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">198
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">199
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">200
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">201
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">202
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">203
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">204
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">205
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">206
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">207
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">208
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">209
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">210
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JAVA" data-lang="JAVA"><span style="color:#000;font-weight:bold">package</span> <span style="color:#555">com.yrq.xposed01</span><span style="color:#000;font-weight:bold">;</span>

<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">android.app.Application</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">android.os.Bundle</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">android.util.Log</span><span style="color:#000;font-weight:bold">;</span>

<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.lang.reflect.Field</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.lang.reflect.Method</span><span style="color:#000;font-weight:bold">;</span>

<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">de.robv.android.xposed.IXposedHookLoadPackage</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">de.robv.android.xposed.XC_MethodHook</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">de.robv.android.xposed.XposedBridge</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">de.robv.android.xposed.XposedHelpers</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">de.robv.android.xposed.callbacks.XC_LoadPackage</span><span style="color:#000;font-weight:bold">;</span>

<span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">HookJava</span> <span style="color:#000;font-weight:bold">implements</span> IXposedHookLoadPackage <span style="color:#000;font-weight:bold">{</span>




    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> Object <span style="color:#900;font-weight:bold">invokeStaticMethod</span><span style="color:#000;font-weight:bold">(</span>String class_name<span style="color:#000;font-weight:bold">,</span>
                                             String method_name<span style="color:#000;font-weight:bold">,</span> Class<span style="color:#000;font-weight:bold">[</span><span style="color:#000;font-weight:bold">]</span> pareTyple<span style="color:#000;font-weight:bold">,</span> Object<span style="color:#000;font-weight:bold">[</span><span style="color:#000;font-weight:bold">]</span> pareVaules<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
            Class obj_class <span style="color:#000;font-weight:bold">=</span> Class<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">forName</span><span style="color:#000;font-weight:bold">(</span>class_name<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            Method method<span style="color:#000;font-weight:bold">=</span> obj_class<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMethod</span><span style="color:#000;font-weight:bold">(</span>method_name<span style="color:#000;font-weight:bold">,</span> pareTyple<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">return</span> method<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">invoke</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span> pareVaules<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>Exception e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">;</span>

    <span style="color:#000;font-weight:bold">}</span>


    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> Object <span style="color:#900;font-weight:bold">getFieldOjbect</span><span style="color:#000;font-weight:bold">(</span>String class_name<span style="color:#000;font-weight:bold">,</span> Object obj<span style="color:#000;font-weight:bold">,</span>
                                        String filedName<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
            Class obj_class <span style="color:#000;font-weight:bold">=</span> Class<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">forName</span><span style="color:#000;font-weight:bold">(</span>class_name<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            Field field <span style="color:#000;font-weight:bold">=</span> obj_class<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getDeclaredField</span><span style="color:#000;font-weight:bold">(</span>filedName<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            field<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setAccessible</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">return</span> field<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span>obj<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>Exception e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">;</span>

    <span style="color:#000;font-weight:bold">}</span>

    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> ClassLoader <span style="color:#900;font-weight:bold">getClassloader</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">{</span>
        ClassLoader resultClassloader<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">;</span>
        Object currentActivityThread<span style="color:#000;font-weight:bold">=</span>invokeStaticMethod<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;android.app.ActivityThread&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;currentActivityThread&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000;font-weight:bold">new</span> Class<span style="color:#000;font-weight:bold">[</span><span style="color:#000;font-weight:bold">]</span><span style="color:#000;font-weight:bold">{</span><span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000;font-weight:bold">new</span> Object<span style="color:#000;font-weight:bold">[</span><span style="color:#000;font-weight:bold">]</span><span style="color:#000;font-weight:bold">{</span><span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        Object mBoundApplication<span style="color:#000;font-weight:bold">=</span>getFieldOjbect<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;android.app.ActivityThread&#34;</span><span style="color:#000;font-weight:bold">,</span>currentActivityThread<span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;mBoundApplication&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        Application mInitalApplication<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(</span>Application<span style="color:#000;font-weight:bold">)</span>getFieldOjbect<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;android.app.ActivityThread&#34;</span><span style="color:#000;font-weight:bold">,</span>currentActivityThread<span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;mInitalApplication&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        Object loadedApkInfo<span style="color:#000;font-weight:bold">=</span>getFieldOjbect<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;android.app.ActivityThread$AppBindData&#34;</span><span style="color:#000;font-weight:bold">,</span>mBoundApplication<span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;info&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        Application mApplication <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span>Application<span style="color:#000;font-weight:bold">)</span>getFieldOjbect<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;android.app.LoadedApk&#34;</span><span style="color:#000;font-weight:bold">,</span>loadedApkInfo<span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;mApplication&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        resultClassloader<span style="color:#000;font-weight:bold">=</span>mApplication<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getClassLoader</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">return</span> resultClassloader<span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span>


    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">GetClassLoaderClasslist</span><span style="color:#000;font-weight:bold">(</span>ClassLoader classloader<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">{</span>
        <span style="color:#998;font-style:italic">//首先通过classloader的反射拿到pathlist, private final DexPathList pathList;
</span><span style="color:#998;font-style:italic"></span>        XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;start dealwith classloader:&#34;</span><span style="color:#000;font-weight:bold">+</span>classloader<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        Object pathListObj<span style="color:#000;font-weight:bold">=</span>XposedHelpers<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getObjectField</span><span style="color:#000;font-weight:bold">(</span>classloader<span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;pathList&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#998;font-style:italic">//接下来拿private Element[] dexElements;
</span><span style="color:#998;font-style:italic"></span>        Object<span style="color:#000;font-weight:bold">[</span><span style="color:#000;font-weight:bold">]</span> dexElementsObj<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(</span>Object<span style="color:#000;font-weight:bold">[</span><span style="color:#000;font-weight:bold">]</span><span style="color:#000;font-weight:bold">)</span>XposedHelpers<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getObjectField</span><span style="color:#000;font-weight:bold">(</span>pathListObj<span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;dexElements&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#998;font-style:italic">//每一个dexElements数组成员都拥有dexfile对象。
</span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span>Object i<span style="color:#000;font-weight:bold">:</span>dexElementsObj<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">{</span>
            <span style="color:#998;font-style:italic">//对数组进行遍历，取出每个dexfile对象
</span><span style="color:#998;font-style:italic"></span>            Object dexFileObj<span style="color:#000;font-weight:bold">=</span>XposedHelpers<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getObjectField</span><span style="color:#000;font-weight:bold">(</span>i<span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;dexFile&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#998;font-style:italic">//通过dexfile的此APIgetClassNameList(df.mCookie);获取类列表
</span><span style="color:#998;font-style:italic"></span>            Object mCookieObj<span style="color:#000;font-weight:bold">=</span>XposedHelpers<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getObjectField</span><span style="color:#000;font-weight:bold">(</span>dexFileObj<span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;mCookie&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#998;font-style:italic">//private static native String[] getClassNameList(Object cookie);
</span><span style="color:#998;font-style:italic"></span>            Class DexFileClass<span style="color:#000;font-weight:bold">=</span>XposedHelpers<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findClass</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;dalvik.system.DexFile&#34;</span><span style="color:#000;font-weight:bold">,</span>classloader<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

            String<span style="color:#000;font-weight:bold">[</span><span style="color:#000;font-weight:bold">]</span> classList<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">[</span><span style="color:#000;font-weight:bold">]</span><span style="color:#000;font-weight:bold">)</span>XposedHelpers<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">callStaticMethod</span><span style="color:#000;font-weight:bold">(</span>DexFileClass<span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;getClassNameList&#34;</span><span style="color:#000;font-weight:bold">,</span>mCookieObj<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span>String classname<span style="color:#000;font-weight:bold">:</span>classList<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">{</span>
                XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span>dexFileObj<span style="color:#000;font-weight:bold">+</span><span style="color:#d14">&#34;---&#34;</span><span style="color:#000;font-weight:bold">+</span>classname<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}</span>
        XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;end dealwith classloader:&#34;</span><span style="color:#000;font-weight:bold">+</span>classloader<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">handleLoadPackage</span><span style="color:#000;font-weight:bold">(</span>XC_LoadPackage<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">LoadPackageParam</span> loadPackageParam<span style="color:#000;font-weight:bold">)</span>
            <span style="color:#000;font-weight:bold">throws</span> Throwable <span style="color:#000;font-weight:bold">{</span>
        Log<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">i</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;HookJava&#34;</span><span style="color:#000;font-weight:bold">,</span>loadPackageParam<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">packageName</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;HookJava app packagename&#34;</span><span style="color:#000;font-weight:bold">+</span>loadPackageParam<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">packageName</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>loadPackageParam<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">packageName</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">equals</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;com.kanxue.xposedhook01&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;YRQ&#34;</span> <span style="color:#000;font-weight:bold">+</span> loadPackageParam<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">packageName</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

            <span style="color:#998;font-style:italic">//public static Unhook findAndHookMethod(String className, ClassLoader classLoader, String methodName, Object... parameterTypesAndCallback) {
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//        return findAndHookMethod(findClass(className, classLoader), methodName, parameterTypesAndCallback);
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//    }
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//    public static Unhook findAndHookMethod(Class&lt;?&gt; clazz, String methodName, Object... parameterTypesAndCallback) {
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//        if (parameterTypesAndCallback.length != 0 &amp;&amp; parameterTypesAndCallback[parameterTypesAndCallback.length - 1] instanceof XC_MethodHook) {
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//            XC_MethodHook callback = (XC_MethodHook)parameterTypesAndCallback[parameterTypesAndCallback.length - 1];
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//            Method m = findMethodExact(clazz, methodName, getParameterClasses(clazz.getClassLoader(), parameterTypesAndCallback));
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//            return XposedBridge.hookMethod(m, callback);
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//        } else {
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//            throw new IllegalArgumentException(&#34;no callback defined&#34;);
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//        }
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//    }
</span><span style="color:#998;font-style:italic"></span>
            ClassLoader classLoader<span style="color:#000;font-weight:bold">=</span>loadPackageParam<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">classLoader</span><span style="color:#000;font-weight:bold">;</span>

            XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;loadPackageParam.classLoader-&gt;&#34;</span><span style="color:#000;font-weight:bold">+</span>classLoader<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            GetClassLoaderClasslist<span style="color:#000;font-weight:bold">(</span>classLoader<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>


            ClassLoader parent<span style="color:#000;font-weight:bold">=</span>classLoader<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getParent</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">while</span><span style="color:#000;font-weight:bold">(</span>parent<span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">{</span>
                XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;parent-&gt;&#34;</span><span style="color:#000;font-weight:bold">+</span>parent<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#998;font-style:italic">//因为bootclassloader不是继承自baseclassloader,所以要过滤掉它
</span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span>parent<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">toString</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">contains</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;BootClassLoader&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">{</span>

                <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">else</span><span style="color:#000;font-weight:bold">{</span>
                    GetClassLoaderClasslist<span style="color:#000;font-weight:bold">(</span>parent<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>

                parent<span style="color:#000;font-weight:bold">=</span>parent<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getParent</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000;font-weight:bold">}</span>


            <span style="color:#998;font-style:italic">//Class StubAppClass=XposedHelpers.findClass(&#34;com.stub.StubApp&#34;,loadPackageParam.classLoader);
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//Method[] methods=StubAppClass.getDeclaredMethods();
</span><span style="color:#998;font-style:italic"></span>           <span style="color:#998;font-style:italic">// for(Method i:methods){
</span><span style="color:#998;font-style:italic"></span>           <span style="color:#998;font-style:italic">//     XposedBridge.log(&#34;com.stub.StubApp-&gt;&#34;+i);
</span><span style="color:#998;font-style:italic"></span>           <span style="color:#998;font-style:italic">// }
</span><span style="color:#998;font-style:italic"></span>
            <span style="color:#998;font-style:italic">//hook onCreate,获取student
</span><span style="color:#998;font-style:italic"></span>            XposedHelpers<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findAndHookMethod</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;com.stub.StubApp&#34;</span><span style="color:#000;font-weight:bold">,</span> loadPackageParam<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">classLoader</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;onCreate&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">new</span> XC_MethodHook<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#3c5d5d;font-weight:bold">@Override</span>
                <span style="color:#000;font-weight:bold">protected</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">beforeHookedMethod</span><span style="color:#000;font-weight:bold">(</span>MethodHookParam param<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">throws</span> Throwable <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">super</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">beforeHookedMethod</span><span style="color:#000;font-weight:bold">(</span>param<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;com.stub.StubApp-&gt;onCreate&#34;</span><span style="color:#000;font-weight:bold">+</span><span style="color:#d14">&#34;onCreate beforeHookedMethod&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>

                <span style="color:#3c5d5d;font-weight:bold">@Override</span>
                <span style="color:#000;font-weight:bold">protected</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">afterHookedMethod</span><span style="color:#000;font-weight:bold">(</span>MethodHookParam param<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">throws</span> Throwable <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">super</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">afterHookedMethod</span><span style="color:#000;font-weight:bold">(</span>param<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;com.stub.StubApp-&gt;onCreate&#34;</span><span style="color:#000;font-weight:bold">+</span><span style="color:#d14">&#34;onCreate afterHookedMethod&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

                    ClassLoader finalClassLoader<span style="color:#000;font-weight:bold">=</span>getClassloader<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;finalClassLoader-&gt;&#34;</span><span style="color:#000;font-weight:bold">+</span>finalClassLoader<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

                    GetClassLoaderClasslist<span style="color:#000;font-weight:bold">(</span>finalClassLoader<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>


                    Class StuClass<span style="color:#000;font-weight:bold">=</span>finalClassLoader<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">loadClass</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;com.kanxue.xposedhook01.Student&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    Class StudentPerson<span style="color:#000;font-weight:bold">=</span>finalClassLoader<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">loadClass</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;com.kanxue.xposedhook01.Student$person&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>


                 XposedHelpers<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findAndHookMethod</span><span style="color:#000;font-weight:bold">(</span>StuClass<span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;publicstaticfunc&#34;</span><span style="color:#000;font-weight:bold">,</span>String<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">,</span><span style="color:#458;font-weight:bold">int</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">new</span> XC_MethodHook<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#3c5d5d;font-weight:bold">@Override</span>
                <span style="color:#000;font-weight:bold">protected</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">beforeHookedMethod</span><span style="color:#000;font-weight:bold">(</span>MethodHookParam param<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">throws</span> Throwable <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">super</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">beforeHookedMethod</span><span style="color:#000;font-weight:bold">(</span>param<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

                    Object<span style="color:#000;font-weight:bold">[</span><span style="color:#000;font-weight:bold">]</span> objectarray<span style="color:#000;font-weight:bold">=</span>param<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">args</span><span style="color:#000;font-weight:bold">;</span>
                    String arg0<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">)</span>objectarray<span style="color:#000;font-weight:bold">[</span>0<span style="color:#000;font-weight:bold">]</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#458;font-weight:bold">int</span> arg1<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span><span style="color:#000;font-weight:bold">)</span>objectarray<span style="color:#000;font-weight:bold">[</span>1<span style="color:#000;font-weight:bold">]</span><span style="color:#000;font-weight:bold">;</span>
                    objectarray<span style="color:#000;font-weight:bold">[</span>0<span style="color:#000;font-weight:bold">]</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;changebyxpsoedjava&#34;</span><span style="color:#000;font-weight:bold">;</span>
                    objectarray<span style="color:#000;font-weight:bold">[</span>1<span style="color:#000;font-weight:bold">]</span><span style="color:#000;font-weight:bold">=</span>10086<span style="color:#000;font-weight:bold">;</span>

                    XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;beforeHookedMethod publicstaticfunc-&gt;arg0:&#34;</span><span style="color:#000;font-weight:bold">+</span>arg0<span style="color:#000;font-weight:bold">+</span><span style="color:#d14">&#34;---arg1:&#34;</span><span style="color:#000;font-weight:bold">+</span>arg1<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

                <span style="color:#000;font-weight:bold">}</span>

                <span style="color:#3c5d5d;font-weight:bold">@Override</span>
                <span style="color:#000;font-weight:bold">protected</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">afterHookedMethod</span><span style="color:#000;font-weight:bold">(</span>MethodHookParam param<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">throws</span> Throwable <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">super</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">afterHookedMethod</span><span style="color:#000;font-weight:bold">(</span>param<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

                    String result<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">)</span>param<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getResult</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    param<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setResult</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;changebyxposed-&gt;afterHookedMethod&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

                    XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;beforeHookedMethod publicstaticfunc-&gt;result:&#34;</span><span style="color:#000;font-weight:bold">+</span>result<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>


                    <span style="color:#998;font-style:italic">//Class StudentPerson=XposedHelpers.findClass(&#34;com.kanxue.xposedhook01.Student$person&#34;,finalClassLoader);
</span><span style="color:#998;font-style:italic"></span>                   XposedHelpers<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findAndHookMethod</span><span style="color:#000;font-weight:bold">(</span>StudentPerson<span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;getpersonname&#34;</span><span style="color:#000;font-weight:bold">,</span> String<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">new</span> XC_MethodHook<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                       <span style="color:#3c5d5d;font-weight:bold">@Override</span>
                       <span style="color:#000;font-weight:bold">protected</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">beforeHookedMethod</span><span style="color:#000;font-weight:bold">(</span>MethodHookParam param<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">throws</span> Throwable <span style="color:#000;font-weight:bold">{</span>
                           <span style="color:#000;font-weight:bold">super</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">beforeHookedMethod</span><span style="color:#000;font-weight:bold">(</span>param<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                           XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;beforeHookedMethod-&gt;getpersonname&#34;</span><span style="color:#000;font-weight:bold">+</span>param<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">args</span><span style="color:#000;font-weight:bold">[</span>0<span style="color:#000;font-weight:bold">]</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                       <span style="color:#000;font-weight:bold">}</span>

                       <span style="color:#3c5d5d;font-weight:bold">@Override</span>
                       <span style="color:#000;font-weight:bold">protected</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">afterHookedMethod</span><span style="color:#000;font-weight:bold">(</span>MethodHookParam param<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">throws</span> Throwable <span style="color:#000;font-weight:bold">{</span>
                           <span style="color:#000;font-weight:bold">super</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">afterHookedMethod</span><span style="color:#000;font-weight:bold">(</span>param<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                           XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;afterHookedMethod-&gt;getName&#34;</span><span style="color:#000;font-weight:bold">+</span>param<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getResult</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                       <span style="color:#000;font-weight:bold">}</span>
                   <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>





                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

            Class StuClass<span style="color:#000;font-weight:bold">=</span>classLoader<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">loadClass</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;com.kanxue.xposedhook01.Student&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

            Class StuClassByXposed<span style="color:#000;font-weight:bold">=</span>XposedHelpers<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findClass</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;com.kanxue.xposedhook01.Student&#34;</span><span style="color:#000;font-weight:bold">,</span>classLoader<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>



        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><p>就跟fart中通过classloader获取所有加载的类。</p>
<h2 id="对多dex的处理">对多dex的处理</h2>
<p>加壳其实是为对多dex处理的特例。加固时是可以通过反射拿到修正后的classloader。 <br>
多dex就不一定在修正的classloader当中了,可能在其他classloader中。</p>
<h3 id="实例">实例</h3>
<p>如此APP：loaddex，这里发现加载资源的函数loaddex并未经过如加壳搬的修复，只是动态加载了。<br>

        <img class="mx-auto" alt="" src="https://gitee.com/kernweak/my-blog/raw/master/img/20210106205810.png" />   
    <br>
1.dex如图<br>

        <img class="mx-auto" alt="" src="https://gitee.com/kernweak/my-blog/raw/master/img/20210106205837.png" />   
    <br>
做了操作之后，就可以看到</p>
<pre><code>01-06 14:08:43.614 3081-3081/com.kanxue.loaddex I/Xposed: beforeHookedMethod,dexpath is  /data/user/0/com.kanxue.loaddex/cache/1.dex,optimizedDirectory is /data/user/0/com.kanxue.loaddex/app_opt_dex,librarySearchPath is /data/user/0/com.kanxue.loaddex/app_lib_path
</code></pre><p>相关代码</p>
<pre><code>package com.yrq.xposed01;

import android.app.Application;
import android.util.Log;

import java.lang.reflect.Field;
import java.lang.reflect.Method;

import dalvik.system.DexClassLoader;
import de.robv.android.xposed.IXposedHookLoadPackage;
import de.robv.android.xposed.XC_MethodHook;
import de.robv.android.xposed.XposedBridge;
import de.robv.android.xposed.XposedHelpers;
import de.robv.android.xposed.callbacks.XC_LoadPackage;

public class HookDynamicDex implements IXposedHookLoadPackage {
    public static Field getClassField(ClassLoader classloader, String class_name, String filedName) {

        try {
            Class obj_class = classloader.loadClass(class_name);
            Field field = obj_class.getDeclaredField(filedName);
            field.setAccessible(true);
            return field;
        } catch (SecurityException e) {
            e.printStackTrace();
        } catch (NoSuchFieldException e) {
            e.printStackTrace();
        } catch (IllegalArgumentException e) {
            e.printStackTrace();
        } catch (ClassNotFoundException e) {
            e.printStackTrace();
        }
        return null;
    }

    public static Object getClassFieldObject(ClassLoader classloader, String class_name, Object obj, String filedName) {

        try {
            Class obj_class = classloader.loadClass(class_name);
            Field field = obj_class.getDeclaredField(filedName);
            field.setAccessible(true);
            Object result = null;
            result = field.get(obj);
            return result;
        } catch (SecurityException e) {
            e.printStackTrace();
        } catch (NoSuchFieldException e) {
            e.printStackTrace();
        } catch (IllegalArgumentException e) {
            e.printStackTrace();
        } catch (ClassNotFoundException e) {
            e.printStackTrace();
        } catch (IllegalAccessException e) {
            e.printStackTrace();
        }
        return null;

    }

    public static Object invokeStaticMethod(String class_name,String method_name, Class[] pareTyple, Object[] pareVaules) {
    try {
        Class obj_class = Class.forName(class_name);
        Method method= obj_class.getMethod(method_name, pareTyple);
        return method.invoke(null, pareVaules);
    } catch (Exception e) {
        e.printStackTrace();
    }
    return null;

}

    public static Object getFieldOjbect(String class_name, Object obj, String filedName) {
        try {
            Class obj_class = Class.forName(class_name);
            Field field = obj_class.getDeclaredField(filedName);
            field.setAccessible(true);
            return field.get(obj);
        } catch (Exception e) {
            e.printStackTrace();
        }
        return null;

    }

    public static ClassLoader getClassloader(){
        ClassLoader resultClassloader=null;
        Object currentActivityThread=invokeStaticMethod(&quot;android.app.ActivityThread&quot;,&quot;currentActivityThread&quot;,new Class[]{},new Object[]{});
        Object mBoundApplication=getFieldOjbect(&quot;android.app.ActivityThread&quot;,currentActivityThread,&quot;mBoundApplication&quot;);
        Application mInitalApplication=(Application)getFieldOjbect(&quot;android.app.ActivityThread&quot;,currentActivityThread,&quot;mInitalApplication&quot;);
        Object loadedApkInfo=getFieldOjbect(&quot;android.app.ActivityThread$AppBindData&quot;,mBoundApplication,&quot;info&quot;);
        Application mApplication = (Application)getFieldOjbect(&quot;android.app.LoadedApk&quot;,loadedApkInfo,&quot;mApplication&quot;);
        resultClassloader=mApplication.getClassLoader();
        return resultClassloader;
    }

    public void GetClassLoaderClasslist(ClassLoader classloader){
        //首先通过classloader的反射拿到pathlist, private final DexPathList pathList;
        XposedBridge.log(&quot;start dealwith classloader:&quot;+classloader);
        Object pathListObj=XposedHelpers.getObjectField(classloader,&quot;pathList&quot;);
        //接下来拿private Element[] dexElements;
        Object[] dexElementsObj=(Object[])XposedHelpers.getObjectField(pathListObj,&quot;dexElements&quot;);
        //每一个dexElements数组成员都拥有dexfile对象。
        for(Object i:dexElementsObj){
            //对数组进行遍历，取出每个dexfile对象
            Object dexFileObj=XposedHelpers.getObjectField(i,&quot;dexFile&quot;);
            //通过dexfile的此APIgetClassNameList(df.mCookie);获取类列表
            Object mCookieObj=XposedHelpers.getObjectField(dexFileObj,&quot;mCookie&quot;);
            //private static native String[] getClassNameList(Object cookie);
            Class DexFileClass=XposedHelpers.findClass(&quot;dalvik.system.DexFile&quot;,classloader);

            String[] classList=(String[])XposedHelpers.callStaticMethod(DexFileClass,&quot;getClassNameList&quot;,mCookieObj);
            for(String classname:classList){
                XposedBridge.log(dexFileObj+&quot;---&quot;+classname);
            }
        }
        XposedBridge.log(&quot;end dealwith classloader:&quot;+classloader);
    }

    @Override
    public void handleLoadPackage(XC_LoadPackage.LoadPackageParam loadPackageParam)
            throws Throwable {
        Log.i(&quot;HookDexClassLoader&quot;,loadPackageParam.packageName);
        XposedBridge.log(&quot;HookDynamicDex-&gt;app packagename&quot;+loadPackageParam.packageName);
        if (loadPackageParam.packageName.equals(&quot;com.kanxue.loaddex&quot;)) {//包名
            // public DexClassLoader(String dexPath, String optimizedDirectory,
            //            String librarySearchPath, ClassLoader parent) {
            //        super(dexPath, null, librarySearchPath, parent);
            //    }
            XposedHelpers.findAndHookConstructor(DexClassLoader.class, String.class, String.class, String.class, ClassLoader.class, new XC_MethodHook() {
                @Override
                protected void beforeHookedMethod(MethodHookParam param) throws Throwable {
                    super.beforeHookedMethod(param);
                    //拿到DEX加载的路经,就是DexClassLoader第一个参数
                    Object array[] = param.args;
                    String dexpath=(String)array[0];
                    String optimizedDirectory=(String)array[1];
                    String librarySearchPath=(String)array[2];

                    XposedBridge.log(&quot;beforeHookedMethod,dexpath is  &quot;+dexpath+&quot;,optimizedDirectory is &quot;+optimizedDirectory+&quot;,librarySearchPath is &quot;+librarySearchPath);
                }
                @Override
                protected void afterHookedMethod(MethodHookParam param) throws Throwable {
                    super.afterHookedMethod(param);

                    //当构造函数结束时，拿到当前dex依附的DexClassLoader
                    DexClassLoader dexClassLoader=(DexClassLoader)param.thisObject;

                    XposedBridge.log(&quot;afterHookedMethod,dexClassLoader is &quot;+dexClassLoader);

                    GetClassLoaderClasslist(dexClassLoader);


                    //public boolean testcontent(String content) {
                    XposedHelpers.findAndHookMethod(&quot;com.kanxue.test02.TestClass&quot;, dexClassLoader, &quot;testcontent&quot;, String.class, new XC_MethodHook() {
                        @Override
                        protected void beforeHookedMethod(MethodHookParam param) throws Throwable {
                            super.beforeHookedMethod(param);
                        }

                        @Override
                        protected void afterHookedMethod(MethodHookParam param) throws Throwable {
                            super.afterHookedMethod(param);
                            //change result
                            param.setResult(true);
                        }
                    });

                }
            });
        }
    }
}
</code></pre><h1 id="hook-so文件中的函数">Hook SO文件中的函数</h1>
<p>我们想要Hook SO中函数，首先思路是hook加载so的函数，在so里编辑hook代码（通过一定hook手段如inlineHook,gothook等实现），让后将其放在3个关键位置执行。如so中：最先加载so的init()里,JNI_OnLoad(),init_array。<br>
我们就需要些Xposed代码先再JAVA层java.lang.Runtime（之前是打算hookjava.lang.System.loadLibrary，不成功，Xposed作者有解释，可以去看项目介绍，所以最后hook了更底层的函数才成功），在此函数加载native-lib时调用hookso的C++代码如下：<br>
Xpsed的JAVA代码：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JAVA" data-lang="JAVA"><span style="color:#000;font-weight:bold">package</span> <span style="color:#555">com.yrq.xposed01</span><span style="color:#000;font-weight:bold">;</span>

<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">android.util.Log</span><span style="color:#000;font-weight:bold">;</span>

<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">de.robv.android.xposed.IXposedHookLoadPackage</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">de.robv.android.xposed.XC_MethodHook</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">de.robv.android.xposed.XposedBridge</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">de.robv.android.xposed.XposedHelpers</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">import</span> <span style="color:#555">de.robv.android.xposed.callbacks.XC_LoadPackage</span><span style="color:#000;font-weight:bold">;</span>

<span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">XposedHookSo</span> <span style="color:#000;font-weight:bold">implements</span> IXposedHookLoadPackage <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">handleLoadPackage</span><span style="color:#000;font-weight:bold">(</span>XC_LoadPackage<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">LoadPackageParam</span> loadPackageParam<span style="color:#000;font-weight:bold">)</span>
            <span style="color:#000;font-weight:bold">throws</span> Throwable <span style="color:#000;font-weight:bold">{</span>
        Log<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">i</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;XposedHookSo&#34;</span><span style="color:#000;font-weight:bold">,</span>loadPackageParam<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">packageName</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;app packagename&#34;</span><span style="color:#000;font-weight:bold">+</span>loadPackageParam<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">packageName</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>loadPackageParam<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">packageName</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">equals</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;com.yrq.xposedhookso&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;XposedHookSo&#34;</span> <span style="color:#000;font-weight:bold">+</span> loadPackageParam<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">packageName</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

            <span style="color:#998;font-style:italic">//首先完成system类的loadlibrary的hook
</span><span style="color:#998;font-style:italic"></span>            XposedHelpers<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findAndHookMethod</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;java.lang.Runtime&#34;</span><span style="color:#000;font-weight:bold">,</span> loadPackageParam<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">classLoader</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;loadLibrary&#34;</span><span style="color:#000;font-weight:bold">,</span> String<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">,</span>ClassLoader<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">new</span> XC_MethodHook<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#3c5d5d;font-weight:bold">@Override</span>
                <span style="color:#000;font-weight:bold">protected</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">beforeHookedMethod</span><span style="color:#000;font-weight:bold">(</span>MethodHookParam param<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">throws</span> Throwable <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">super</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">beforeHookedMethod</span><span style="color:#000;font-weight:bold">(</span>param<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    String soname<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">)</span>param<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">args</span><span style="color:#000;font-weight:bold">[</span>0<span style="color:#000;font-weight:bold">]</span><span style="color:#000;font-weight:bold">;</span>
                    XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;beforeHookedMethod Runtime.load(&#34;</span><span style="color:#000;font-weight:bold">+</span>soname<span style="color:#000;font-weight:bold">+</span><span style="color:#d14">&#34;)&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                <span style="color:#000;font-weight:bold">}</span>

                <span style="color:#3c5d5d;font-weight:bold">@Override</span>
                <span style="color:#000;font-weight:bold">protected</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">afterHookedMethod</span><span style="color:#000;font-weight:bold">(</span>MethodHookParam param<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">throws</span> Throwable <span style="color:#000;font-weight:bold">{</span>
                    <span style="color:#000;font-weight:bold">super</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">afterHookedMethod</span><span style="color:#000;font-weight:bold">(</span>param<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    String soname<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">)</span>param<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">args</span><span style="color:#000;font-weight:bold">[</span>0<span style="color:#000;font-weight:bold">]</span><span style="color:#000;font-weight:bold">;</span>
                    XposedBridge<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;afterHookedMethod Runtime.load(&#34;</span><span style="color:#000;font-weight:bold">+</span>soname<span style="color:#000;font-weight:bold">+</span><span style="color:#d14">&#34;)&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span>soname<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">contains</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;native-lib&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">{</span>
                        System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">load</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/data/data/tmp/libnative-lib.so&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
                    <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#000;font-weight:bold">}</span>
            <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><p>hookso.so代码主体如下，记得配置ndk汇编语言种类：<br>

        <img class="mx-auto" alt="" src="https://gitee.com/kernweak/my-blog/raw/master/img/20210106231714.png" />   
    <br>
代码参考的github为：</p>
<blockquote>
<p><a href="https://github.com/ele7enxxh/Android-Inline-Hook">https://github.com/ele7enxxh/Android-Inline-Hook</a></p>
</blockquote>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JAVA" data-lang="JAVA"><span style="color:#a61717;background-color:#e3d2d2">#</span>include <span style="color:#000;font-weight:bold">&lt;</span>jni<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">h</span><span style="color:#000;font-weight:bold">&gt;</span>
<span style="color:#a61717;background-color:#e3d2d2">#</span>include <span style="color:#000;font-weight:bold">&lt;</span>string<span style="color:#000;font-weight:bold">&gt;</span>
<span style="color:#a61717;background-color:#e3d2d2">#</span>include <span style="color:#000;font-weight:bold">&lt;</span>android<span style="color:#000;font-weight:bold">/</span>log<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">h</span><span style="color:#000;font-weight:bold">&gt;</span>
<span style="color:#a61717;background-color:#e3d2d2">#</span>include <span style="color:#000;font-weight:bold">&lt;</span>dlfcn<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">h</span><span style="color:#000;font-weight:bold">&gt;</span>

extern <span style="color:#d14">&#34;C&#34;</span> <span style="color:#000;font-weight:bold">{</span>
<span style="color:#a61717;background-color:#e3d2d2">#</span>include <span style="color:#d14">&#34;include/inlineHook.h&#34;</span>
<span style="color:#000;font-weight:bold">}</span>


<span style="color:#458;font-weight:bold">void</span> <span style="color:#000;font-weight:bold">*</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">*</span>old_strstr<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">char</span> <span style="color:#000;font-weight:bold">*</span><span style="color:#000;font-weight:bold">,</span><span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">*</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">=</span> nullptr<span style="color:#000;font-weight:bold">;</span>

<span style="color:#458;font-weight:bold">void</span> <span style="color:#000;font-weight:bold">*</span> new_strstr<span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">*</span> arg0<span style="color:#000;font-weight:bold">,</span><span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">*</span> arg1<span style="color:#000;font-weight:bold">)</span>
<span style="color:#000;font-weight:bold">{</span>

    __android_log_print<span style="color:#000;font-weight:bold">(</span>4<span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;hookso&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;strstr is called,arg1:,%s,arg2:%s&#34;</span><span style="color:#000;font-weight:bold">,</span>arg0<span style="color:#000;font-weight:bold">,</span>arg1<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

    <span style="color:#000;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span>strcmp<span style="color:#000;font-weight:bold">(</span>arg1<span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;hookso&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span>0<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">{</span>
        <span style="color:#458;font-weight:bold">int</span> a<span style="color:#000;font-weight:bold">=</span>1<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">&amp;</span>a<span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">else</span><span style="color:#000;font-weight:bold">{</span>
        <span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span> result<span style="color:#000;font-weight:bold">=</span> old_strstr<span style="color:#000;font-weight:bold">(</span>arg0<span style="color:#000;font-weight:bold">,</span> arg1<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">return</span> result<span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span>

<span style="color:#000;font-weight:bold">}</span>








<span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">starthooklibc</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>

    <span style="color:#998;font-style:italic">//低版本中，通过dlopen()函数获取handle
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span> libchandle<span style="color:#000;font-weight:bold">=</span>dlopen<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;libc.so&#34;</span><span style="color:#000;font-weight:bold">,</span>RTLD_NOW<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span> strstr_addr<span style="color:#000;font-weight:bold">=</span>dlsym<span style="color:#000;font-weight:bold">(</span>libchandle<span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;strstr&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>registerInlineHook<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">(</span>uint32_t<span style="color:#000;font-weight:bold">)</span> strstr_addr<span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">(</span>uint32_t<span style="color:#000;font-weight:bold">)</span> new_strstr<span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">(</span>uint32_t <span style="color:#000;font-weight:bold">*</span><span style="color:#000;font-weight:bold">*</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">&amp;</span>old_strstr<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">!</span><span style="color:#000;font-weight:bold">=</span> ELE7EN_OK<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>inlineHook<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">(</span>uint32_t<span style="color:#000;font-weight:bold">)</span> strstr_addr<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span> ELE7EN_OK<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        __android_log_print<span style="color:#000;font-weight:bold">(</span>4<span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;hookso&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;hook libc.so-&gt;strstr success&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>

extern <span style="color:#d14">&#34;C&#34;</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">_init</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">{</span>
    starthooklibc<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">}</span>
extern <span style="color:#d14">&#34;C&#34;</span> JNIEXPORT jstring JNICALL
<span style="color:#900;font-weight:bold">Java_com_yrq_hookso_MainActivity_stringFromJNI</span><span style="color:#000;font-weight:bold">(</span>
        JNIEnv<span style="color:#000;font-weight:bold">*</span> env<span style="color:#000;font-weight:bold">,</span>
        jobject <span style="color:#998;font-style:italic">/* this */</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    std<span style="color:#000;font-weight:bold">:</span><span style="color:#000;font-weight:bold">:</span>string hello <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Hello from C++&#34;</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">return</span> env<span style="color:#000;font-weight:bold">-</span><span style="color:#000;font-weight:bold">&gt;</span>NewStringUTF<span style="color:#000;font-weight:bold">(</span>hello<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">c_str</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><p>将生成的so修改为代码命名的hookso.so的名字再放进去。</p>
<pre><code>yrq@ubuntu:~/Desktop/xposed/app-debug.apk_FILES/lib/armeabi-v7a$ adb push libnative-lib.so /sdcard
libnative-lib.so: 1 file pushed. 0.8 MB/s (116316 bytes in 0.148s)
yrq@ubuntu:~/Desktop/xposed/app-debug.apk_FILES/lib/armeabi-v7a$ adb shell
shell@hammerhead:/ $ su
root@hammerhead:/ # cd /data/data/
root@hammerhead:/data/data # mkdir tmp
root@hammerhead:/data/data # chmod 777 tmp/                                    
root@hammerhead:/data/data # cd tmp
cp /sdcard/libnative-lib.so  .                                                 &lt;
root@hammerhead:/data/data/tmp # ls
libnative-lib.so
root@hammerhead:/data/data/tmp # ls -il
   82613 -rw------- root     root       116316 2021-01-07 00:31 libnative-lib.so
chmod 777 libnative-lib.so                                                     &lt;
root@hammerhead:/data/data/tmp # ls -il
   82613 -rwxrwxrwx root     root       116316 2021-01-07 00:31 libnative-lib.so
root@hammerhead:/data/data/tmp # 

</code></pre><p>结果就从hook前的：</p>
<pre><code>01-06 17:59:34.820 5098-5098/com.yrq.xposedhookso I/xposedhookso: not find xposedhookso
01-06 17:59:34.820 5098-5098/com.yrq.xposedhookso I/xposedhookso: not find aaaaaaaaaaaaaaaaaab
</code></pre><p>变成了</p>
<pre><code>01-07 00:41:01.125 3265-3265/com.yrq.xposedhookso I/xposedhookso: find xposedhookso
01-07 00:41:01.125 3265-3265/com.yrq.xposedhookso I/xposedhookso: find aaaaaaaaaaaaaaaaaab
</code></pre><h2 id="关于64位的支持">关于64位的支持</h2>
<p>可以看到高低版本安卓9.0，6.0参数出现区别<br>

        <img class="mx-auto" alt="" src="https://gitee.com/kernweak/my-blog/raw/master/img/20210107231224.png" />   
    <br>

        <img class="mx-auto" alt="" src="https://gitee.com/kernweak/my-blog/raw/master/img/20210107231505.png" />   
    <br>
所以需要hook函数时要注意参数变化。<br>
并且不能使用之前的inlinehook需要使用如sandhook之类的其他框架，这里使用sandhook。<br>
编写
64为so文件，在次文件的init函数中完成hook，这里不用init原因是sandhook框架在init时还未初始化完全，在init_array里有操作，而init_array晚于init执行。<br>
这里方法是：</p>
<ol>
<li>在init_array里添加hook代码，优先级设置低。</li>
<li>在JNI_Onload里设置。<br>
###流程
将sandhook的nativehook代码拷入so项目。<br>
注意修改编译配置</li>
</ol>
<pre><code>externalNativeBuild {
            cmake {
                cppFlags &quot;-std=c++11&quot;
            }
        }
</code></pre><p>代码如下：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JAVA" data-lang="JAVA"><span style="color:#a61717;background-color:#e3d2d2">#</span>include <span style="color:#000;font-weight:bold">&lt;</span>jni<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">h</span><span style="color:#000;font-weight:bold">&gt;</span>
<span style="color:#a61717;background-color:#e3d2d2">#</span>include <span style="color:#000;font-weight:bold">&lt;</span>string<span style="color:#000;font-weight:bold">&gt;</span>
<span style="color:#a61717;background-color:#e3d2d2">#</span>include <span style="color:#d14">&#34;sandhook_native.h&#34;</span>
<span style="color:#a61717;background-color:#e3d2d2">#</span>include <span style="color:#d14">&#34;../../../../../../Android/Sdk/ndk/21.1.6352462/toolchains/llvm/prebuilt/linux-x86_64/sysroot/usr/include/jni.h&#34;</span>
<span style="color:#a61717;background-color:#e3d2d2">#</span>include <span style="color:#d14">&#34;utils/log.h&#34;</span>
<span style="color:#a61717;background-color:#e3d2d2">#</span>include <span style="color:#000;font-weight:bold">&lt;</span>android<span style="color:#000;font-weight:bold">/</span>log<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">h</span><span style="color:#000;font-weight:bold">&gt;</span>
<span style="color:#458;font-weight:bold">void</span> <span style="color:#000;font-weight:bold">*</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">*</span>old_strstr<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">char</span> <span style="color:#000;font-weight:bold">*</span><span style="color:#000;font-weight:bold">,</span><span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">*</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">=</span> nullptr<span style="color:#000;font-weight:bold">;</span>

<span style="color:#458;font-weight:bold">void</span> <span style="color:#000;font-weight:bold">*</span> new_strstr<span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">*</span> arg0<span style="color:#000;font-weight:bold">,</span><span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">*</span> arg1<span style="color:#000;font-weight:bold">)</span>
<span style="color:#000;font-weight:bold">{</span>

    __android_log_print<span style="color:#000;font-weight:bold">(</span>4<span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;hooksoArm64&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;strstr is called,arg1:,%s,arg2:%s&#34;</span><span style="color:#000;font-weight:bold">,</span>arg0<span style="color:#000;font-weight:bold">,</span>arg1<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

    <span style="color:#000;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span>strcmp<span style="color:#000;font-weight:bold">(</span>arg1<span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;hookso&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span>0<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">{</span>
        <span style="color:#458;font-weight:bold">int</span> a<span style="color:#000;font-weight:bold">=</span>1<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">&amp;</span>a<span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">else</span><span style="color:#000;font-weight:bold">{</span>
        <span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span> result<span style="color:#000;font-weight:bold">=</span> old_strstr<span style="color:#000;font-weight:bold">(</span>arg0<span style="color:#000;font-weight:bold">,</span> arg1<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">return</span> result<span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span>

<span style="color:#000;font-weight:bold">}</span>




extern <span style="color:#d14">&#34;C&#34;</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">starthooklibc</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#998;font-style:italic">//首先获取libc中的strstr
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">//32位libc在/system/lib
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">//64位在/system/lib64
</span><span style="color:#998;font-style:italic"></span>
    <span style="color:#998;font-style:italic">//如果为64位
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span>sizeof<span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span>8<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">const</span> <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">*</span> libcPath<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;/system/lib64/libc.so&#34;</span><span style="color:#000;font-weight:bold">;</span>
        old_strstr<span style="color:#000;font-weight:bold">=</span> reinterpret_cast<span style="color:#000;font-weight:bold">&lt;</span><span style="color:#458;font-weight:bold">void</span> <span style="color:#000;font-weight:bold">*</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">*</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">char</span> <span style="color:#000;font-weight:bold">*</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">char</span> <span style="color:#000;font-weight:bold">*</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">(</span>SandInlineHookSym<span style="color:#000;font-weight:bold">(</span>libcPath<span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;strstr&#34;</span><span style="color:#000;font-weight:bold">,</span>
                                        reinterpret_cast<span style="color:#000;font-weight:bold">&lt;</span><span style="color:#458;font-weight:bold">void</span> <span style="color:#000;font-weight:bold">*</span><span style="color:#000;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">(</span>new_strstr<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">else</span><span style="color:#000;font-weight:bold">{</span>

    <span style="color:#000;font-weight:bold">}</span>


<span style="color:#000;font-weight:bold">}</span>


extern <span style="color:#d14">&#34;C&#34;</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">_init</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">{</span>
    LOlogGD<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;go into JNI_OnLoad&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

<span style="color:#000;font-weight:bold">}</span>

extern <span style="color:#d14">&#34;C&#34;</span> jint JNICALL <span style="color:#900;font-weight:bold">JNI_Onload</span><span style="color:#000;font-weight:bold">(</span>JavaVM<span style="color:#000;font-weight:bold">*</span> vm<span style="color:#000;font-weight:bold">,</span><span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span> reserved<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">{</span>
    LOGD<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;go into JNI_OnLoad&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
    starthooklibc<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">return</span> JNI_VERSION_1_6<span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">}</span>

extern <span style="color:#d14">&#34;C&#34;</span> JNIEXPORT jstring JNICALL
<span style="color:#900;font-weight:bold">Java_com_yrq_xposedhooksobysandhook_MainActivity_stringFromJNI</span><span style="color:#000;font-weight:bold">(</span>
        JNIEnv<span style="color:#000;font-weight:bold">*</span> env<span style="color:#000;font-weight:bold">,</span>
        jobject <span style="color:#998;font-style:italic">/* this */</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    std<span style="color:#000;font-weight:bold">:</span><span style="color:#000;font-weight:bold">:</span>string hello <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Hello from C++&#34;</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">return</span> env<span style="color:#000;font-weight:bold">-</span><span style="color:#000;font-weight:bold">&gt;</span>NewStringUTF<span style="color:#000;font-weight:bold">(</span>hello<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">c_str</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">}</span>

</code></pre></td></tr></table>
</div>
</div><h1 id="主动调用so函数">主动调用so函数</h1>
<p>首先想主动调用的函数在ida里可以看见在模块中偏移是871C,注意thumb指令奇数。 <br>

        <img class="mx-auto" alt="" src="https://gitee.com/kernweak/my-blog/raw/master/img/20210109205538.png" />   
    <br>
原so</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JAVA" data-lang="JAVA">plugins <span style="color:#000;font-weight:bold">{</span>
    id <span style="color:#a61717;background-color:#e3d2d2">&#39;</span>com<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">android</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">application</span><span style="color:#a61717;background-color:#e3d2d2">&#39;</span>
<span style="color:#000;font-weight:bold">}</span>

android <span style="color:#000;font-weight:bold">{</span>
    compileSdkVersion 30
    buildToolsVersion <span style="color:#d14">&#34;30.0.2&#34;</span>

    defaultConfig <span style="color:#000;font-weight:bold">{</span>
        applicationId <span style="color:#d14">&#34;com.yrq.xposedhookso&#34;</span>
        minSdkVersion 16
        targetSdkVersion 30
        versionCode 1
        versionName <span style="color:#d14">&#34;1.0&#34;</span>

        testInstrumentationRunner <span style="color:#d14">&#34;androidx.test.runner.AndroidJUnitRunner&#34;</span>


        ndk<span style="color:#000;font-weight:bold">{</span>
            abiFilters <span style="color:#a61717;background-color:#e3d2d2">&#39;</span>armeabi<span style="color:#000;font-weight:bold">-</span>v7a<span style="color:#a61717;background-color:#e3d2d2">&#39;</span>
        <span style="color:#000;font-weight:bold">}</span>
   

        externalNativeBuild <span style="color:#000;font-weight:bold">{</span>
            cmake <span style="color:#000;font-weight:bold">{</span>
                cppFlags <span style="color:#d14">&#34;-std=c++11&#34;</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>

    buildTypes <span style="color:#000;font-weight:bold">{</span>
        release <span style="color:#000;font-weight:bold">{</span>
            minifyEnabled <span style="color:#000;font-weight:bold">false</span>
            proguardFiles <span style="color:#900;font-weight:bold">getDefaultProguardFile</span><span style="color:#000;font-weight:bold">(</span><span style="color:#a61717;background-color:#e3d2d2">&#39;</span>proguard<span style="color:#000;font-weight:bold">-</span>android<span style="color:#000;font-weight:bold">-</span>optimize<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">txt</span><span style="color:#a61717;background-color:#e3d2d2">&#39;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a61717;background-color:#e3d2d2">&#39;</span>proguard<span style="color:#000;font-weight:bold">-</span>rules<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">pro</span><span style="color:#a61717;background-color:#e3d2d2">&#39;</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>
    externalNativeBuild <span style="color:#000;font-weight:bold">{</span>
        cmake <span style="color:#000;font-weight:bold">{</span>
            path <span style="color:#d14">&#34;src/main/cpp/CMakeLists.txt&#34;</span>
            version <span style="color:#d14">&#34;3.10.2&#34;</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">}</span>
    compileOptions <span style="color:#000;font-weight:bold">{</span>
        sourceCompatibility JavaVersion<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">VERSION_1_8</span>
        targetCompatibility JavaVersion<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">VERSION_1_8</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>

dependencies <span style="color:#000;font-weight:bold">{</span>

    implementation <span style="color:#a61717;background-color:#e3d2d2">&#39;</span>androidx<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">appcompat</span><span style="color:#000;font-weight:bold">:</span>appcompat<span style="color:#000;font-weight:bold">:</span>1<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">2</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">0</span><span style="color:#a61717;background-color:#e3d2d2">&#39;</span>
    implementation <span style="color:#a61717;background-color:#e3d2d2">&#39;</span>com<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">google</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">android</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">material</span><span style="color:#000;font-weight:bold">:</span>material<span style="color:#000;font-weight:bold">:</span>1<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">2</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">1</span><span style="color:#a61717;background-color:#e3d2d2">&#39;</span>
    implementation <span style="color:#a61717;background-color:#e3d2d2">&#39;</span>androidx<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">constraintlayout</span><span style="color:#000;font-weight:bold">:</span>constraintlayout<span style="color:#000;font-weight:bold">:</span>2<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">0</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">2</span><span style="color:#a61717;background-color:#e3d2d2">&#39;</span>
    testImplementation <span style="color:#a61717;background-color:#e3d2d2">&#39;</span>junit<span style="color:#000;font-weight:bold">:</span>junit<span style="color:#000;font-weight:bold">:</span>4<span style="color:#000;font-weight:bold">.</span><span style="color:#000;font-weight:bold">+</span><span style="color:#a61717;background-color:#e3d2d2">&#39;</span>
    androidTestImplementation <span style="color:#a61717;background-color:#e3d2d2">&#39;</span>androidx<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">test</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ext</span><span style="color:#000;font-weight:bold">:</span>junit<span style="color:#000;font-weight:bold">:</span>1<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">1</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">2</span><span style="color:#a61717;background-color:#e3d2d2">&#39;</span>
    androidTestImplementation <span style="color:#a61717;background-color:#e3d2d2">&#39;</span>androidx<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">test</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">espresso</span><span style="color:#000;font-weight:bold">:</span>espresso<span style="color:#000;font-weight:bold">-</span>core<span style="color:#000;font-weight:bold">:</span>3<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">3</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">0</span><span style="color:#a61717;background-color:#e3d2d2">&#39;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><p>hook代码so库中相关代码：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">85
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JAVA" data-lang="JAVA"><span style="color:#a61717;background-color:#e3d2d2">#</span>include <span style="color:#000;font-weight:bold">&lt;</span>jni<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">h</span><span style="color:#000;font-weight:bold">&gt;</span>
<span style="color:#a61717;background-color:#e3d2d2">#</span>include <span style="color:#000;font-weight:bold">&lt;</span>string<span style="color:#000;font-weight:bold">&gt;</span>
<span style="color:#a61717;background-color:#e3d2d2">#</span>include <span style="color:#d14">&#34;sandhook_native.h&#34;</span>
<span style="color:#a61717;background-color:#e3d2d2">#</span>include <span style="color:#d14">&#34;../../../../../../Android/Sdk/ndk/21.1.6352462/toolchains/llvm/prebuilt/linux-x86_64/sysroot/usr/include/jni.h&#34;</span>
<span style="color:#a61717;background-color:#e3d2d2">#</span>include <span style="color:#d14">&#34;utils/log.h&#34;</span>
<span style="color:#a61717;background-color:#e3d2d2">#</span>include <span style="color:#000;font-weight:bold">&lt;</span>android<span style="color:#000;font-weight:bold">/</span>log<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">h</span><span style="color:#000;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">&gt;</span>
<span style="color:#458;font-weight:bold">void</span> <span style="color:#000;font-weight:bold">*</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">*</span>old_strstr<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">char</span> <span style="color:#000;font-weight:bold">*</span><span style="color:#000;font-weight:bold">,</span><span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">*</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">=</span> nullptr<span style="color:#000;font-weight:bold">;</span>


<span style="color:#458;font-weight:bold">void</span> <span style="color:#000;font-weight:bold">*</span> new_strstr<span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">*</span> arg0<span style="color:#000;font-weight:bold">,</span><span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">*</span> arg1<span style="color:#000;font-weight:bold">)</span>
<span style="color:#000;font-weight:bold">{</span>

    __android_log_print<span style="color:#000;font-weight:bold">(</span>4<span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;hooksoArm64&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;strstr is called,arg1:,%s,arg2:%s&#34;</span><span style="color:#000;font-weight:bold">,</span>arg0<span style="color:#000;font-weight:bold">,</span>arg1<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

    <span style="color:#000;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span>strcmp<span style="color:#000;font-weight:bold">(</span>arg1<span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;hookso&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span>0<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">{</span>
        <span style="color:#458;font-weight:bold">int</span> a<span style="color:#000;font-weight:bold">=</span>1<span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">&amp;</span>a<span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">else</span><span style="color:#000;font-weight:bold">{</span>
        <span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span> result<span style="color:#000;font-weight:bold">=</span> old_strstr<span style="color:#000;font-weight:bold">(</span>arg0<span style="color:#000;font-weight:bold">,</span> arg1<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">return</span> result<span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span>

<span style="color:#000;font-weight:bold">}</span>




extern <span style="color:#d14">&#34;C&#34;</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">starthooklibc</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#998;font-style:italic">//首先获取libc中的strstr
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">//32位libc在/system/lib
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">//64位在/system/lib64
</span><span style="color:#998;font-style:italic"></span>
    <span style="color:#998;font-style:italic">//如果为64位
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span>sizeof<span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">=</span>8<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">const</span> <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">*</span> libcPath<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;/system/lib64/libc.so&#34;</span><span style="color:#000;font-weight:bold">;</span>
        old_strstr<span style="color:#000;font-weight:bold">=</span> reinterpret_cast<span style="color:#000;font-weight:bold">&lt;</span><span style="color:#458;font-weight:bold">void</span> <span style="color:#000;font-weight:bold">*</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">*</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">char</span> <span style="color:#000;font-weight:bold">*</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">char</span> <span style="color:#000;font-weight:bold">*</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">(</span>SandInlineHookSym<span style="color:#000;font-weight:bold">(</span>libcPath<span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;strstr&#34;</span><span style="color:#000;font-weight:bold">,</span>
                                                                                  reinterpret_cast<span style="color:#000;font-weight:bold">&lt;</span><span style="color:#458;font-weight:bold">void</span> <span style="color:#000;font-weight:bold">*</span><span style="color:#000;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">(</span>new_strstr<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">else</span><span style="color:#000;font-weight:bold">{</span>

    <span style="color:#000;font-weight:bold">}</span>


<span style="color:#000;font-weight:bold">}</span>
<span style="color:#998;font-style:italic">//bool testhook(const char* content){
</span><span style="color:#998;font-style:italic"></span><span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">activecalltesthook</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">{</span>
    typedef <span style="color:#900;font-weight:bold">int</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">*</span>testhook<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">const</span> <span style="color:#458;font-weight:bold">char</span><span style="color:#000;font-weight:bold">*</span> a1<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
    testhook testhookfunction<span style="color:#000;font-weight:bold">=</span> nullptr<span style="color:#000;font-weight:bold">;</span>
    <span style="color:#998;font-style:italic">//得到函数地址
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span> libnativebase<span style="color:#000;font-weight:bold">=</span>SandGetModuleBase<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;libnative-lib.so&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

    unsigned <span style="color:#458;font-weight:bold">long</span> tmpaddr<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">(</span>unsigned  <span style="color:#458;font-weight:bold">long</span><span style="color:#000;font-weight:bold">)</span>libnativebase<span style="color:#000;font-weight:bold">+</span>0x871C<span style="color:#000;font-weight:bold">;</span>

    <span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span> testhookaddr<span style="color:#000;font-weight:bold">=</span> reinterpret_cast<span style="color:#000;font-weight:bold">&lt;</span><span style="color:#458;font-weight:bold">void</span> <span style="color:#000;font-weight:bold">*</span><span style="color:#000;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">(</span>tmpaddr<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
    testhookfunction<span style="color:#000;font-weight:bold">=</span> reinterpret_cast<span style="color:#000;font-weight:bold">&lt;</span>testhook<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">(</span>testhookaddr<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>


    <span style="color:#458;font-weight:bold">int</span> result1<span style="color:#000;font-weight:bold">=</span>testhookfunction<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;aaaaaaaaaaaaaaso&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

    LOGD<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;testhookfunction(aaaaaaaaaaaaaaso);return %d&#34;</span><span style="color:#000;font-weight:bold">,</span>result1<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

    <span style="color:#458;font-weight:bold">int</span> result2<span style="color:#000;font-weight:bold">=</span>testhookfunction<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;aaaaaabbbbbbbbbb&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
    LOGD<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;testhookfunction(aaaaaabbbbbbbbbb);return %d&#34;</span><span style="color:#000;font-weight:bold">,</span>result2<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

<span style="color:#000;font-weight:bold">}</span>


extern <span style="color:#d14">&#34;C&#34;</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">_init</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">{</span>
    LOGD<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;go into _init&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>

<span style="color:#000;font-weight:bold">}</span>

extern <span style="color:#d14">&#34;C&#34;</span> jint JNICALL <span style="color:#900;font-weight:bold">JNI_OnLoad</span><span style="color:#000;font-weight:bold">(</span>JavaVM<span style="color:#000;font-weight:bold">*</span> vm<span style="color:#000;font-weight:bold">,</span><span style="color:#458;font-weight:bold">void</span><span style="color:#000;font-weight:bold">*</span> reserved<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">{</span>
    LOGD<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;go into JNI_OnLoad&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
    starthooklibc<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
    activecalltesthook<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">return</span> JNI_VERSION_1_6<span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">}</span>

extern <span style="color:#d14">&#34;C&#34;</span> JNIEXPORT jstring JNICALL
<span style="color:#900;font-weight:bold">Java_com_yrq_xposedhooksobysandhook_MainActivity_stringFromJNI</span><span style="color:#000;font-weight:bold">(</span>
        JNIEnv<span style="color:#000;font-weight:bold">*</span> env<span style="color:#000;font-weight:bold">,</span>
        jobject <span style="color:#998;font-style:italic">/* this */</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    std<span style="color:#000;font-weight:bold">:</span><span style="color:#000;font-weight:bold">:</span>string hello <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Hello from C++&#34;</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">return</span> env<span style="color:#000;font-weight:bold">-</span><span style="color:#000;font-weight:bold">&gt;</span>NewStringUTF<span style="color:#000;font-weight:bold">(</span>hello<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">c_str</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="xposed指纹检测与简单定制反检测">Xposed指纹检测与简单定制反检测</h1>
<h2 id="xposed指纹">Xposed指纹</h2>
<ol>
<li>Xposed插件管理：XposedInstaller</li>
<li>Xposed对函数Hook的管理：java函数变native函数。</li>
<li>Xposed框架有大量API</li>
<li>Xposed框架的特点文件等。</li>
</ol>
<h1 id="fdex2">Fdex2</h1>
<p>loadclass()和forName()区别是后者加载类会初始化。<br>
要想完成dump dex，要拿到dex中某个类的class对象可以通过hook classLoader(这里是Xposed参数中的classLoader)，得到其中一个class，就可以dumpdex。<br>
想要拿到实际的classloader，要通过已经加载正常app时，进行反射，所以可以进入正常线程休眠一段时间，这时就是所需classloader。<br>
想要对目标app进程动态修改，1是ptrace-attach,2是加载到app所在进程空间中。<br>
下面就是利用Fdex2的代码：</p>
<pre><code>package com.yrq.xposed01;

import android.app.Application;
import android.util.Log;

import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.OutputStream;
import java.lang.reflect.Field;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;

import de.robv.android.xposed.IXposedHookLoadPackage;
import de.robv.android.xposed.XC_MethodHook;
import de.robv.android.xposed.XposedBridge;
import de.robv.android.xposed.XposedHelpers;
import de.robv.android.xposed.callbacks.XC_LoadPackage;

public class XposedFdex2 implements  IXposedHookLoadPackage {

    Class Dex;
    Method Dex_getBytes;
    Method getDex;
    String packagename;


    public static Field getClassField(ClassLoader classloader, String class_name, String filedName) {

        try {
            Class obj_class = classloader.loadClass(class_name);
            Field field = obj_class.getDeclaredField(filedName);
            field.setAccessible(true);
            return field;
        } catch (SecurityException e) {
            e.printStackTrace();
        } catch (NoSuchFieldException e) {
            e.printStackTrace();
        } catch (IllegalArgumentException e) {
            e.printStackTrace();
        } catch (ClassNotFoundException e) {
            e.printStackTrace();
        }
        return null;
    }

    public static Object getClassFieldObject(ClassLoader classloader, String class_name, Object obj, String filedName) {

        try {
            Class obj_class = classloader.loadClass(class_name);
            Field field = obj_class.getDeclaredField(filedName);
            field.setAccessible(true);
            Object result = null;
            result = field.get(obj);
            return result;
        } catch (SecurityException e) {
            e.printStackTrace();
        } catch (NoSuchFieldException e) {
            e.printStackTrace();
        } catch (IllegalArgumentException e) {
            e.printStackTrace();
        } catch (ClassNotFoundException e) {
            e.printStackTrace();
        } catch (IllegalAccessException e) {
            e.printStackTrace();
        }
        return null;

    }

    public static Object invokeStaticMethod(String class_name,String method_name, Class[] pareTyple, Object[] pareVaules) {
        try {
            Class obj_class = Class.forName(class_name);
            Method method= obj_class.getMethod(method_name, pareTyple);
            return method.invoke(null, pareVaules);
        } catch (Exception e) {
            e.printStackTrace();
        }
        return null;

    }

    public static Object getFieldOjbect(String class_name, Object obj, String filedName) {
        try {
            Class obj_class = Class.forName(class_name);
            Field field = obj_class.getDeclaredField(filedName);
            field.setAccessible(true);
            return field.get(obj);
        } catch (Exception e) {
            e.printStackTrace();
        }
        return null;

    }

    public static ClassLoader getClassloader(){
        ClassLoader resultClassloader=null;
        Object currentActivityThread=invokeStaticMethod(&quot;android.app.ActivityThread&quot;,&quot;currentActivityThread&quot;,new Class[]{},new Object[]{});
        Object mBoundApplication=getFieldOjbect(&quot;android.app.ActivityThread&quot;,currentActivityThread,&quot;mBoundApplication&quot;);
        Application mInitalApplication=(Application)getFieldOjbect(&quot;android.app.ActivityThread&quot;,currentActivityThread,&quot;mInitalApplication&quot;);
        Object loadedApkInfo=getFieldOjbect(&quot;android.app.ActivityThread$AppBindData&quot;,mBoundApplication,&quot;info&quot;);
        Application mApplication = (Application)getFieldOjbect(&quot;android.app.LoadedApk&quot;,loadedApkInfo,&quot;mApplication&quot;);
        resultClassloader=mApplication.getClassLoader();
        return resultClassloader;
    }


    public void handleLoadPackage(XC_LoadPackage.LoadPackageParam lpparam) throws Throwable {

        initReflect();
        packagename=lpparam.packageName;

        XposedBridge.log(&quot;设定包名：&quot;+packagename);
        if(lpparam.packageName.equals(&quot;com.example.classloadertest&quot;)){

            new Thread(new Runnable() {
                @Override
                public void run() {
                    try {
                        Thread.sleep(10*1000);
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                    XposedBridge.log(&quot;sleep over start dump dex&quot;);
                    ClassLoader classloader =getClassloader();

                    try {
                        Class MainActivityClass=classloader.loadClass(&quot;com.example.classloadertest.MainActivity&quot;);

                        XposedBridge.log(&quot;sleep over start dump dex by class:&quot;+MainActivityClass);
                        dumpdexbyClass(MainActivityClass);

                    } catch (ClassNotFoundException e) {
                        e.printStackTrace();
                    } catch (IllegalAccessException e) {
                        e.printStackTrace();
                    } catch (InvocationTargetException e) {
                        e.printStackTrace();
                    }
                }
            }).start();
        }

        if ((!lpparam.packageName.equals(packagename))||packagename==null) {
            XposedBridge.log(&quot;当前程序包名与设定不一致或者包名为空&quot;);
            return;
        }
        XposedBridge.log(&quot;目标包名：&quot;+lpparam.packageName);
        //想要拿到实际的classloader，要通过已经加载正常app时，进行反射



//        String str = &quot;java.lang.ClassLoader&quot;;
//        String str2 = &quot;loadClass&quot;;
//
//        XposedHelpers.findAndHookMethod(str, lpparam.classLoader, str2, String.class, Boolean.TYPE, new XC_MethodHook() {
//            protected void afterHookedMethod(XC_MethodHook.MethodHookParam param) throws Throwable {
//                super.afterHookedMethod(param);
//                Class cls = (Class) param.getResult();
//                dumpdexbyClass(cls);
//
//            }
//        } );



    }

    public void dumpdexbyClass(Class cls) throws InvocationTargetException, IllegalAccessException {
        if (cls == null) {
            //XposedBridge.log(&quot;cls == null&quot;);
            return;
        }
        String name = cls.getName();
        XposedBridge.log(&quot;当前类名：&quot; + name);
        byte[] bArr = (byte[]) Dex_getBytes.invoke(getDex.invoke(cls, new Object[0]), new Object[0]);
        if (bArr == null) {
            XposedBridge.log(&quot;数据为空：返回&quot;);
            return;
        }
        XposedBridge.log(&quot;开始写数据&quot;);
        String dex_path = &quot;/data/data/&quot; + packagename + &quot;/&quot; + packagename + &quot;_&quot; + bArr.length + &quot;.dex&quot;;
        XposedBridge.log(dex_path);
        File file = new File(dex_path);
        if (file.exists()) return;
        writeByte(bArr, file.getAbsolutePath());
    }

    //初始化函数，通过反射，获取2个API
    public void initReflect() {
        try {
            Dex = Class.forName(&quot;com.android.dex.Dex&quot;);
            Dex_getBytes = Dex.getDeclaredMethod(&quot;getBytes&quot;, new Class[0]);
            getDex = Class.forName(&quot;java.lang.Class&quot;).getDeclaredMethod(&quot;getDex&quot;, new Class[0]);
        } catch (ClassNotFoundException e) {
            e.printStackTrace();
        } catch (NoSuchMethodException e) {
            e.printStackTrace();
        }

    }

    //保存拿到dex的内容
    public  void writeByte(byte[] bArr, String str) {
        try {
            OutputStream outputStream = new FileOutputStream(str);
            outputStream.write(bArr);
            outputStream.close();
        } catch (IOException e) {
            e.printStackTrace();
            XposedBridge.log(&quot;文件写出失败&quot;);
        }
    }
}
</code></pre><p>结果如下，已经打出想要的dex：<br>

        <img class="mx-auto" alt="" src="https://gitee.com/kernweak/my-blog/raw/master/img/20210112214258.png" />   
    <br>
我们在脱壳操作中，想要获取dex_file的beign_和size_。dex_file是有虚函数的。<br>
为了方便，与通用最好找导出的函数，返回值是dex_file这种。<br>
另外一种方法为把系统的libart拖出来，比如n5就在/system/lib/libart.so中在导出表查找参数或返回值有DexFile。</p>
<pre><code> art::verifier::MethodVerifier::VerifyClass(art::Thread *, art::DexFile const*, art::Handle&lt;art::mirror::DexCache&gt;, art::Handle&lt;art::mirror::ClassLoader&gt;, art::DexFile::ClassDef const*, bool, std::string *)  
 
 
_ZN3art8verifier14MethodVerifier11VerifyClassEPNS_6ThreadEPKNS_7DexFileENS_6HandleINS_6mirror8DexCacheEEENS7_INS8_11ClassLoaderEEEPKNS4_8ClassDefEbPNSt3__112basic_stringIcNSG_11char_traitsIcEENSG_9allocatorIcEEEE
.text:00364B0C _ZN3art8verifier14MethodVerifier11VerifyClassEPNS_6ThreadEPKNS_7DexFileENS_6HandleINS_6mirror8DexCacheEEENS7_INS8_11ClassLoaderEEEPKNS4_8ClassDefEbPNSt3__112basic_stringIcNSG_11char_traitsIcEENSG_9allocatorIcEEEE
</code></pre><p>再去查看源码<br>

        <img class="mx-auto" alt="" src="https://gitee.com/kernweak/my-blog/raw/master/img/20210113000240.png" />   
    <br>
或者以下几个函数都可以找到dexFile</p>
<pre><code>_ZN3art11PrettyFieldEjRKNS_7DexFileEb  
_ZN3art11ClassLinker11ResolveTypeERKNS_7DexFileEtPNS_6mirror5ClassE    
_ZN3art11ClassLinker22LoadSuperAndInterfacesENS_6HandleINS_6mirror5ClassEEERKNS_7DexFileE  
</code></pre><p>因为app插件是注入到app进程空间，所以在一个地址空间，所以这种时候app相当于这就是我们自己编写的app，插件是都可以对其进行访问修改。现在要做的是拿到要hook函数地址，借助hook框架，进行hook</p>

        </div>

        
<div class="post-archive">
    <ul class="post-copyright">
        <li><strong>原文作者：</strong><a rel="author" href="https://kernweak.github.io/">Kernweak</a></li>
        <li style="word-break:break-all"><strong>原文链接：</strong><a href="https://kernweak.github.io/post/Android/Xposed/Xposed%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">https://kernweak.github.io/post/Android/Xposed/Xposed%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/</a></li>
        <li><strong>版权声明：</strong>本作品采用<a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可，非商业转载请注明出处（作者，原文链接），商业转载请联系作者获得授权。</li>
    </ul>
</div>
<br/>



        


        <div class="post-meta meta-tags">
            
            没有标签
            
        </div>
    </article>
    
    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "yourdiscussshortname" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "your github repo"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
</div>

                    <footer id="footer">
    <div>
        &copy; 2021 <a href="https://kernweak.github.io/">Kernweak&#39;s Blog By Kernweak</a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://www.flysnow.org/" target="_black"><span class="badge-subject">Design by</span><span class="badge-value bg-brightgreen">飞雪无情</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>



    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




    <script src='/js/douban.js'></script>

                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://kernweak.github.io/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://kernweak.github.io/">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://kernweak.github.io/post/Android/Xposed/Xposed%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" title="Xposed基础知识">Xposed基础知识</a>
    </li>
    
</ul>
    </section>

    
<section class="widget">
    <h3 class="widget-title" style="color:red">福利派送</h3>
    <ul class="widget-list">
        
        <li>
            <a href="https://www.aliyun.com/minisite/goods?userCode=jdg9oj97&amp;share_source=copy_link" title="【2019双12】ALL IN CLoud 低至1折" target="_blank" style="color:red">
                
                    <img src="https://img.alicdn.com/tfs/TB1_rYHo7P2gK0jSZPxXXacQpXa-690-388.jpg">
                
            </a>
        </li>
        
        <li>
            <a href="https://cloud.tencent.com/act/cps/redirect?redirect=1048&amp;cps_key=14ff722692ac784fa8c3301c8c28d924&amp;from=console" title="助力产业智慧升级，云服务器首年88元起，更有千元代金券礼包免费领！" target="_blank" style="color:red">
                
                    <img src="https://upload-dianshi-1255598498.file.myqcloud.com/345-7c71532bd4935fbdd9a67c1a71e577b1767b805c.200%E7%89%88%E6%9C%ACB.jpg">
                
            </a>
        </li>
        
        <li>
            <a href="https://www.aliyun.com/acts/limit-buy?userCode=jdg9oj97" title="【渠道专享低折扣】11月特惠 限时2折" target="_blank" style="color:red">
                
                    <img src="https://img.alicdn.com/tfs/TB1hblJl7Y2gK0jSZFgXXc5OFXa-750-400.jpg">
                
            </a>
        </li>
        
    </ul>
</section>


    <section class="widget">
        <h3 class="widget-title"><a href='/categories/'>分类</a></h3>
<ul class="widget-list">
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='/tags/'>标签</a></h3>
<div class="tagcloud">
    
</div>
    </section>

    
<section class="widget">
    <h3 class="widget-title">友情链接</h3>
    <ul class="widget-list">
        
        <li>
            <a target="_blank" href="https://blog.csdn.net/youyou519" title="csdn的博客">csdn的博客</a>
        </li>
        
    </ul>
</section>


    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://kernweak.github.io/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
</body>

</html>